--- START FILE: tsconfig.node.json ---
// tsconfig.node.json
{
    // No "extends"
    "compilerOptions": {
      "composite": true,            // Required by referencing config
      "module": "CommonJS",         // Correct for Node/Electron main/preload
      "moduleResolution": "Node",   // Correct module resolution
      "target": "ESNext",           // Target modern JS for Electron
      "lib": ["ESNext", "DOM"],     // Include necessary libs

      "noEmit": false,              // We MUST emit JS files
      "outDir": "dist-electron",    // Output directory
      "rootDir": "src",             // Source root directory

      /* Base URL and Paths are needed if using aliases within main/preload code */
      "baseUrl": ".",               // Define baseUrl if using paths
      "paths": {                    // Keep paths if used within main/preload code
        "@renderer/*": ["src/renderer/*"],
        "@main/*": ["src/main/*"],
        "@preload/*": ["src/preload/*"]
        //"@shared/*": ["src/shared/*"]
      },

      "strict": true,                 // Enable strict checks
      "esModuleInterop": true,        // Recommended for CJS/ESM interop
      "forceConsistentCasingInFileNames": true, // Good practice
      "skipLibCheck": false,          // *** Temporarily FALSE to force checks/emission ***

      /* Node/Electron Specific Overrides */
      "allowImportingTsExtensions": false, // No .ts imports in CJS output
      "resolveJsonModule": true,          // Allow importing JSON
      "isolatedModules": false            // Not isolated modules
    },
    // Includes - Define what this config compiles
    "include": [
      "src/main/**/*.ts",             // Compile main process code
      "src/preload/**/*.ts",          // Compile preload code
      "src/shared.types.ts"           // Compile shared types if they exist (remove if not)
    ],
    // Excludes - Define what NOT to compile
    "exclude": [
      "node_modules",                 // Standard excludes
      "dist",
      "dist-electron",                // Exclude output from input
      "src/renderer"                  // Exclude renderer code
    ]
  }
--- END FILE: tsconfig.node.json ---

--- START FILE: text.txt ---
---

**Continuation Prompt for CodeCraft IDE Development**

**Project:** CodeCraft IDE - A desktop IDE using Electron, React, TypeScript.

**Current Status:**
We have successfully set up the development environment using a manual Vite configuration with a multi-terminal workflow:
1.  Terminal 1: `npm run dev:main` (Compiles `src/main` and `src/preload` via `tsc --watch`)
2.  Terminal 2: `npm run dev:vite` (Runs Vite dev server via `vite`)
3.  Terminal 3: `npm start` (Launches the Electron app via `electron .`)

The application structure includes:
*   **Main Process (`src/main/index.ts`):** Handles window creation, IPC (Ping, PTY management, Dialog), application menu creation (File, Edit, View with Theme submenu), and `node-pty` management. Compiles to CommonJS. Hardware acceleration disabled.
*   **Preload Script (`src/preload/index.ts`):** Exposes an `electronAPI` via `contextBridge` for IPC (Ping, PTY, Dialog, Menu Theme/Open Folder actions). Compiles to CommonJS.
*   **Renderer Process (`src/renderer`):** Uses React, TypeScript, and Vite.
    *   **Layout:** Uses `Allotment` for a resizable vertical split between the Editor and Terminal panels, inside a main content area next to a fixed `Sidebar`.
    *   **Theming:**
        *   Uses React Context (`ThemeContext`) to manage the current theme name (`light`, `dark`, `win95`, `pipboy`, `mirc`).
        *   Applies theme classes (`.theme-*`) to the root and body elements.
        *   `index.css` defines extensive CSS variables and specific style overrides for each theme.
        *   Includes a custom React dropdown component (`CustomSelect.tsx`) for theme switching in the `Sidebar`.
        *   Top application menu (`View > Theme`) reflects and can set the current theme.
    *   **Editor Panel:** Renders a functional Monaco Editor instance using `react-monaco-editor`. Basic custom Monaco themes are defined and applied based on the selected app theme (e.g., `pipboy-monaco-theme`).
    *   **Terminal Panel:** Renders a functional Xterm.js terminal using manual `Terminal` instantiation and `FitAddon`. The terminal's colors are updated based on the selected app theme. IPC bridge (`pty-create`, `pty-input`, `pty-resize`, `pty-data`, `pty-exit`) is functional. Resizing via `FitAddon` and IPC is handled.
    *   **Sidebar:** Contains a placeholder for the file tree and the custom theme switcher dropdown.

**Key Dependencies Installed:** `electron`, `react`, `typescript`, `vite`, `monaco-editor`, `react-monaco-editor`, `xterm`, `xterm-addon-fit`, `node-pty`, `allotment`, `electron-squirrel-startup`.

**V1 Goals Recap (Original + New):**
*   Functional Monaco Editor (Done - basic)
*   Integrated Terminal (xterm+node-pty) (Done - basic)
*   File Tree/Management (Not started)
*   Theming (Foundation done: CSS Vars, aesthetic themes, VS Code compatible base needed)
*   Font Size Control (To be implemented)
*   Movable/Resizable Panels (Partially done - vertical split)

**Next Steps to Implement:**

1.  **File Management (Core Functionality):**
    *   **Sidebar UI:** Replace placeholder with a file/folder listing component.
    *   **Open Folder:** Wire up the "File > Open Folder..." menu item (and/or add a button) to trigger `dialog:openDirectory` IPC, store the selected path in the renderer state/context.
    *   **Read Directory:** Implement IPC handler (`fs:read-directory`) in main using Node `fs` to read contents of the selected path. Send file/folder list back.
    *   **Display Tree:** Populate Sidebar component with the list, make it expandable/collapsible.
    *   **Read File:** IPC handler (`fs:read-file`) in main to read file content.
    *   **Load in Editor:** On file click, trigger `fs:read-file` IPC, update Monaco Editor value and language mode.
    *   **Save File:** IPC handler (`fs:save-file`) in main. Add save mechanism (Ctrl+S, menu) in renderer to send content/path.
    *   **(Optional)** Tabs for multiple open files.

2.  **Theming System (Phase 2 - VS Code Integration):**
    *   IPC handlers for opening/reading VS Code theme `.json` files.
    *   Main process parser to extract colors (`workbench.colorCustomizations`, `tokenColors`).
    *   Map VS Code keys to our CSS variables & Monaco theme keys.
    *   Dynamically update CSS variables and apply `monaco.editor.defineTheme`.

3.  **Theming System (Phase 3 - Refinements):**
    *   Refine aesthetic theme definitions (CSS and Monaco) for better accuracy/completeness.
    *   Handle font loading robustly.

4.  **Font Size Control:**
    *   Re-implement a robust font size control mechanism (e.g., using context, updating CSS variables, ensuring editor/terminal resize correctly).

5.  **Layout Enhancements:**
    *   Consider adding horizontal splitting (e.g., Sidebar vs Main Content Area) using `Allotment`.
    *   Explore more complex layouts if needed (e.g., multiple editor groups like VS Code, potentially using React-Mosaic).

6.  **Terminal Refinements:**
    *   Improve visual handling of the `pty-exit` event.
    *   Add a "clear terminal" command/button.

7.  **Editor Enhancements:**
    *   Configure more Monaco options (minimap, word wrap, etc.).
    *   Indicate unsaved changes.

**Question:** Which of these next steps should we focus on now? (File Management is strongly recommended as the next core feature).

---
--- END FILE: text.txt ---

--- START FILE: index.html ---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" /> <!-- Example icon -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeCraft IDE (TS)</title>
  </head>
  <body>
    <!-- The root element where React app mounts -->
    <!-- The ThemeProvider will add theme classes here -->
    <div id="root"></div>
    <!-- Entry point script for the renderer process -->
    <script type="module" src="/src/renderer/main.tsx"></script>
  </body>
</html>
--- END FILE: index.html ---

--- START FILE: .gitignore ---
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

# Diagnostic reports (https://nodejs.org/api/report.html)
report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage
*.lcov

# nyc test coverage
.nyc_output

# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (if used)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# Snowpack dependency directory (if used)
web_modules/

# TypeScript cache
*.tsbuildinfo

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional stylelint cache
.stylelintcache

# Microbundle cache
.rpt2_cache/
.rts2_cache_cjs/
.rts2_cache_es/
.rts2_cache_umd/

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env
.env*.local
.env.*.local

# parcel-bundler cache (https://parceljs.org/)
.cache
.parcel-cache

# Next.js build output
.next
out

# Nuxt.js build output
.nuxt
dist

# Nuxt.js static build output
.output

# Docusaurus cache and build output (if used)
.docusaurus

# Gatsby cache and build output
.cache/
public

# SvelteKit build output
.svelte-kit

# Remix build output
.cache/
build/
public/build/

# Vite build output
dist/
# Vite Electron build output (specifically for main/preload JS)
dist-electron/

# Vite cache directory
.vite/

# Electron Packager/Builder Output
release/
out/
build/ # Often used by electron-builder, check config if different

# macOS specific files
.DS_Store
.AppleDouble
.LSOverride

# Thumbnails
Thumbs.db
ehthumbs.db
ehthumbs_vista.db

# Swap files
*.swp
*.swo

# IDE specific files
.idea/
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
*.sublime-workspace
*.sublime-project

# Misc
*.iml
--- END FILE: .gitignore ---

--- START FILE: tsconfig.node.tsbuildinfo ---
{"fileNames":["./node_modules/typescript/lib/lib.es5.d.ts","./node_modules/typescript/lib/lib.es2015.d.ts","./node_modules/typescript/lib/lib.es2016.d.ts","./node_modules/typescript/lib/lib.es2017.d.ts","./node_modules/typescript/lib/lib.es2018.d.ts","./node_modules/typescript/lib/lib.es2019.d.ts","./node_modules/typescript/lib/lib.es2020.d.ts","./node_modules/typescript/lib/lib.es2021.d.ts","./node_modules/typescript/lib/lib.es2022.d.ts","./node_modules/typescript/lib/lib.es2023.d.ts","./node_modules/typescript/lib/lib.es2024.d.ts","./node_modules/typescript/lib/lib.esnext.d.ts","./node_modules/typescript/lib/lib.dom.d.ts","./node_modules/typescript/lib/lib.es2015.core.d.ts","./node_modules/typescript/lib/lib.es2015.collection.d.ts","./node_modules/typescript/lib/lib.es2015.generator.d.ts","./node_modules/typescript/lib/lib.es2015.iterable.d.ts","./node_modules/typescript/lib/lib.es2015.promise.d.ts","./node_modules/typescript/lib/lib.es2015.proxy.d.ts","./node_modules/typescript/lib/lib.es2015.reflect.d.ts","./node_modules/typescript/lib/lib.es2015.symbol.d.ts","./node_modules/typescript/lib/lib.es2015.symbol.wellknown.d.ts","./node_modules/typescript/lib/lib.es2016.array.include.d.ts","./node_modules/typescript/lib/lib.es2016.intl.d.ts","./node_modules/typescript/lib/lib.es2017.arraybuffer.d.ts","./node_modules/typescript/lib/lib.es2017.date.d.ts","./node_modules/typescript/lib/lib.es2017.object.d.ts","./node_modules/typescript/lib/lib.es2017.sharedmemory.d.ts","./node_modules/typescript/lib/lib.es2017.string.d.ts","./node_modules/typescript/lib/lib.es2017.intl.d.ts","./node_modules/typescript/lib/lib.es2017.typedarrays.d.ts","./node_modules/typescript/lib/lib.es2018.asyncgenerator.d.ts","./node_modules/typescript/lib/lib.es2018.asynciterable.d.ts","./node_modules/typescript/lib/lib.es2018.intl.d.ts","./node_modules/typescript/lib/lib.es2018.promise.d.ts","./node_modules/typescript/lib/lib.es2018.regexp.d.ts","./node_modules/typescript/lib/lib.es2019.array.d.ts","./node_modules/typescript/lib/lib.es2019.object.d.ts","./node_modules/typescript/lib/lib.es2019.string.d.ts","./node_modules/typescript/lib/lib.es2019.symbol.d.ts","./node_modules/typescript/lib/lib.es2019.intl.d.ts","./node_modules/typescript/lib/lib.es2020.bigint.d.ts","./node_modules/typescript/lib/lib.es2020.date.d.ts","./node_modules/typescript/lib/lib.es2020.promise.d.ts","./node_modules/typescript/lib/lib.es2020.sharedmemory.d.ts","./node_modules/typescript/lib/lib.es2020.string.d.ts","./node_modules/typescript/lib/lib.es2020.symbol.wellknown.d.ts","./node_modules/typescript/lib/lib.es2020.intl.d.ts","./node_modules/typescript/lib/lib.es2020.number.d.ts","./node_modules/typescript/lib/lib.es2021.promise.d.ts","./node_modules/typescript/lib/lib.es2021.string.d.ts","./node_modules/typescript/lib/lib.es2021.weakref.d.ts","./node_modules/typescript/lib/lib.es2021.intl.d.ts","./node_modules/typescript/lib/lib.es2022.array.d.ts","./node_modules/typescript/lib/lib.es2022.error.d.ts","./node_modules/typescript/lib/lib.es2022.intl.d.ts","./node_modules/typescript/lib/lib.es2022.object.d.ts","./node_modules/typescript/lib/lib.es2022.string.d.ts","./node_modules/typescript/lib/lib.es2022.regexp.d.ts","./node_modules/typescript/lib/lib.es2023.array.d.ts","./node_modules/typescript/lib/lib.es2023.collection.d.ts","./node_modules/typescript/lib/lib.es2023.intl.d.ts","./node_modules/typescript/lib/lib.es2024.arraybuffer.d.ts","./node_modules/typescript/lib/lib.es2024.collection.d.ts","./node_modules/typescript/lib/lib.es2024.object.d.ts","./node_modules/typescript/lib/lib.es2024.promise.d.ts","./node_modules/typescript/lib/lib.es2024.regexp.d.ts","./node_modules/typescript/lib/lib.es2024.sharedmemory.d.ts","./node_modules/typescript/lib/lib.es2024.string.d.ts","./node_modules/typescript/lib/lib.esnext.array.d.ts","./node_modules/typescript/lib/lib.esnext.collection.d.ts","./node_modules/typescript/lib/lib.esnext.intl.d.ts","./node_modules/typescript/lib/lib.esnext.disposable.d.ts","./node_modules/typescript/lib/lib.esnext.promise.d.ts","./node_modules/typescript/lib/lib.esnext.decorators.d.ts","./node_modules/typescript/lib/lib.esnext.iterator.d.ts","./node_modules/typescript/lib/lib.esnext.float16.d.ts","./node_modules/typescript/lib/lib.decorators.d.ts","./node_modules/typescript/lib/lib.decorators.legacy.d.ts","./src/main/env.d.ts","./node_modules/@types/node/compatibility/disposable.d.ts","./node_modules/@types/node/compatibility/indexable.d.ts","./node_modules/@types/node/compatibility/iterators.d.ts","./node_modules/@types/node/compatibility/index.d.ts","./node_modules/@types/node/globals.typedarray.d.ts","./node_modules/@types/node/buffer.buffer.d.ts","./node_modules/buffer/index.d.ts","./node_modules/undici-types/header.d.ts","./node_modules/undici-types/readable.d.ts","./node_modules/undici-types/file.d.ts","./node_modules/undici-types/fetch.d.ts","./node_modules/undici-types/formdata.d.ts","./node_modules/undici-types/connector.d.ts","./node_modules/undici-types/client.d.ts","./node_modules/undici-types/errors.d.ts","./node_modules/undici-types/dispatcher.d.ts","./node_modules/undici-types/global-dispatcher.d.ts","./node_modules/undici-types/global-origin.d.ts","./node_modules/undici-types/pool-stats.d.ts","./node_modules/undici-types/pool.d.ts","./node_modules/undici-types/handlers.d.ts","./node_modules/undici-types/balanced-pool.d.ts","./node_modules/undici-types/agent.d.ts","./node_modules/undici-types/mock-interceptor.d.ts","./node_modules/undici-types/mock-agent.d.ts","./node_modules/undici-types/mock-client.d.ts","./node_modules/undici-types/mock-pool.d.ts","./node_modules/undici-types/mock-errors.d.ts","./node_modules/undici-types/proxy-agent.d.ts","./node_modules/undici-types/env-http-proxy-agent.d.ts","./node_modules/undici-types/retry-handler.d.ts","./node_modules/undici-types/retry-agent.d.ts","./node_modules/undici-types/api.d.ts","./node_modules/undici-types/interceptors.d.ts","./node_modules/undici-types/util.d.ts","./node_modules/undici-types/cookies.d.ts","./node_modules/undici-types/patch.d.ts","./node_modules/undici-types/websocket.d.ts","./node_modules/undici-types/eventsource.d.ts","./node_modules/undici-types/filereader.d.ts","./node_modules/undici-types/diagnostics-channel.d.ts","./node_modules/undici-types/content-type.d.ts","./node_modules/undici-types/cache.d.ts","./node_modules/undici-types/index.d.ts","./node_modules/@types/node/globals.d.ts","./node_modules/@types/node/assert.d.ts","./node_modules/@types/node/assert/strict.d.ts","./node_modules/@types/node/async_hooks.d.ts","./node_modules/@types/node/buffer.d.ts","./node_modules/@types/node/child_process.d.ts","./node_modules/@types/node/cluster.d.ts","./node_modules/@types/node/console.d.ts","./node_modules/@types/node/constants.d.ts","./node_modules/@types/node/crypto.d.ts","./node_modules/@types/node/dgram.d.ts","./node_modules/@types/node/diagnostics_channel.d.ts","./node_modules/@types/node/dns.d.ts","./node_modules/@types/node/dns/promises.d.ts","./node_modules/@types/node/domain.d.ts","./node_modules/@types/node/dom-events.d.ts","./node_modules/@types/node/events.d.ts","./node_modules/@types/node/fs.d.ts","./node_modules/@types/node/fs/promises.d.ts","./node_modules/@types/node/http.d.ts","./node_modules/@types/node/http2.d.ts","./node_modules/@types/node/https.d.ts","./node_modules/@types/node/inspector.d.ts","./node_modules/@types/node/module.d.ts","./node_modules/@types/node/net.d.ts","./node_modules/@types/node/os.d.ts","./node_modules/@types/node/path.d.ts","./node_modules/@types/node/perf_hooks.d.ts","./node_modules/@types/node/process.d.ts","./node_modules/@types/node/punycode.d.ts","./node_modules/@types/node/querystring.d.ts","./node_modules/@types/node/readline.d.ts","./node_modules/@types/node/readline/promises.d.ts","./node_modules/@types/node/repl.d.ts","./node_modules/@types/node/sea.d.ts","./node_modules/@types/node/stream.d.ts","./node_modules/@types/node/stream/promises.d.ts","./node_modules/@types/node/stream/consumers.d.ts","./node_modules/@types/node/stream/web.d.ts","./node_modules/@types/node/string_decoder.d.ts","./node_modules/@types/node/test.d.ts","./node_modules/@types/node/timers.d.ts","./node_modules/@types/node/timers/promises.d.ts","./node_modules/@types/node/tls.d.ts","./node_modules/@types/node/trace_events.d.ts","./node_modules/@types/node/tty.d.ts","./node_modules/@types/node/url.d.ts","./node_modules/@types/node/util.d.ts","./node_modules/@types/node/v8.d.ts","./node_modules/@types/node/vm.d.ts","./node_modules/@types/node/wasi.d.ts","./node_modules/@types/node/worker_threads.d.ts","./node_modules/@types/node/zlib.d.ts","./node_modules/@types/node/index.d.ts","./node_modules/electron/electron.d.ts","./node_modules/node-pty/typings/node-pty.d.ts","./src/main/index.ts","./src/preload/index.ts","./src/shared.types.ts","./node_modules/@babel/types/lib/index.d.ts","./node_modules/@types/babel__generator/index.d.ts","./node_modules/@babel/parser/typings/babel-parser.d.ts","./node_modules/@types/babel__template/index.d.ts","./node_modules/@types/babel__traverse/index.d.ts","./node_modules/@types/babel__core/index.d.ts","./node_modules/keyv/src/index.d.ts","./node_modules/@types/http-cache-semantics/index.d.ts","./node_modules/@types/responselike/index.d.ts","./node_modules/@types/cacheable-request/index.d.ts","./node_modules/@types/ms/index.d.ts","./node_modules/@types/debug/index.d.ts","./node_modules/@types/estree/index.d.ts","./node_modules/@types/fs-extra/index.d.ts","./node_modules/@types/keyv/index.d.ts","./node_modules/@types/prop-types/index.d.ts","./node_modules/@types/react/global.d.ts","./node_modules/csstype/index.d.ts","./node_modules/@types/react/index.d.ts","./node_modules/@types/react-dom/index.d.ts","./node_modules/@types/yauzl/index.d.ts","../node_modules/@types/connect/index.d.ts","../node_modules/@types/body-parser/index.d.ts","../node_modules/@types/bonjour/index.d.ts","../node_modules/@types/mime/index.d.ts","../node_modules/@types/send/index.d.ts","../node_modules/@types/qs/index.d.ts","../node_modules/@types/range-parser/index.d.ts","../node_modules/@types/express-serve-static-core/index.d.ts","../node_modules/@types/connect-history-api-fallback/index.d.ts","../node_modules/@types/estree/index.d.ts","../node_modules/@types/json-schema/index.d.ts","../node_modules/@types/eslint/use-at-your-own-risk.d.ts","../node_modules/@types/eslint/index.d.ts","../node_modules/@types/eslint-scope/index.d.ts","../node_modules/@types/http-errors/index.d.ts","../node_modules/@types/serve-static/index.d.ts","../node_modules/@types/express/node_modules/@types/express-serve-static-core/index.d.ts","../node_modules/@types/express/index.d.ts","../node_modules/@types/minimatch/index.d.ts","../node_modules/@types/glob/index.d.ts","../node_modules/@types/graceful-fs/index.d.ts","../node_modules/@types/html-minifier-terser/index.d.ts","../node_modules/@types/http-proxy/index.d.ts","../node_modules/@types/istanbul-lib-coverage/index.d.ts","../node_modules/@types/istanbul-lib-report/index.d.ts","../node_modules/@types/istanbul-reports/index.d.ts","../node_modules/@types/node-forge/index.d.ts","../node_modules/@types/retry/index.d.ts","../node_modules/@types/serve-index/index.d.ts","../node_modules/@types/sockjs/index.d.ts","../node_modules/@types/stack-utils/index.d.ts","../node_modules/@types/ws/index.d.ts","../node_modules/@types/yargs-parser/index.d.ts","../node_modules/@types/yargs/index.d.ts"],"fileIdsList":[[86,129,184],[86,129],[86,129,184,185,186,187,188],[86,129,184,186],[86,129,141,144,171,178,190,191,192],[86,129,194],[86,129,142,178],[86,129,141,178],[86,126,129],[86,128,129],[129],[86,129,134,163],[86,129,130,135,141,142,149,160,171],[86,129,130,131,141,149],[81,82,83,86,129],[86,129,132,172],[86,129,133,134,142,150],[86,129,134,160,168],[86,129,135,137,141,149],[86,128,129,136],[86,129,137,138],[86,129,141],[86,129,139,141],[86,128,129,141],[86,129,141,142,143,160,171],[86,129,141,142,143,156,160,163],[86,124,129,176],[86,129,137,141,144,149,160,171],[86,129,141,142,144,145,149,160,168,171],[86,129,144,146,160,168,171],[84,85,86,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177],[86,129,141,147],[86,129,148,171,176],[86,129,137,141,149,160],[86,129,150],[86,129,151],[86,128,129,152],[86,126,127,128,129,130,131,132,133,134,135,136,137,138,139,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177],[86,129,154],[86,129,155],[86,129,141,156,157],[86,129,156,158,172,174],[86,129,141,160,161,163],[86,129,162,163],[86,129,160,161],[86,129,163],[86,129,164],[86,126,129,160],[86,129,141,166,167],[86,129,166,167],[86,129,134,149,160,168],[86,129,169],[86,129,149,170],[86,129,144,155,171],[86,129,134,172],[86,129,160,173],[86,129,148,174],[86,129,175],[86,129,134,141,143,152,160,171,174,176],[86,129,160,177],[86,129,202],[86,129,199,200,201],[86,129,144,160,178],[86,129,141,160,178],[86,129,141,142,178],[86,96,100,129,171],[86,96,129,160,171],[86,91,129],[86,93,96,129,168,171],[86,129,149,168],[86,129,178],[86,91,129,178],[86,93,96,129,149,171],[86,88,89,92,95,129,141,160,171],[86,96,103,129],[86,88,94,129],[86,96,117,118,129],[86,92,96,129,163,171,178],[86,117,129,178],[86,90,91,129,178],[86,96,129],[86,90,91,92,93,94,95,96,97,98,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,118,119,120,121,122,123,129],[86,96,111,129],[86,96,103,104,129],[86,94,96,104,105,129],[86,95,129],[86,88,91,96,129],[86,96,100,104,105,129],[86,100,129],[86,94,96,99,129,171],[86,88,93,96,103,129],[86,129,160],[86,91,96,117,129,176,178],[86,129,150,151,179,180],[86,129,179],[86,129,144,178,205],[86,129,135,178],[86,129,171,178,212],[86,129,144,178],[86,129,214,217],[86,129,214,215,216],[86,129,217],[86,129,141,144,178,209,210,211],[86,129,206,210,212,220,221],[86,129,141,142,178,223],[86,129,141,144,146,149,160,171,178],[86,129,228],[86,129,229],[86,129,142,160,178,208],[86,129,142,222],[86,129,144,178,209,219],[86,129,141,144,146,160,168,171,177,178],[86,129,237]],"fileInfos":[{"version":"69684132aeb9b5642cbcd9e22dff7818ff0ee1aa831728af0ecf97d3364d5546","affectsGlobalScope":true,"impliedFormat":1},{"version":"45b7ab580deca34ae9729e97c13cfd999df04416a79116c3bfb483804f85ded4","impliedFormat":1},{"version":"3facaf05f0c5fc569c5649dd359892c98a85557e3e0c847964caeb67076f4d75","impliedFormat":1},{"version":"e44bb8bbac7f10ecc786703fe0a6a4b952189f908707980ba8f3c8975a760962","impliedFormat":1},{"version":"5e1c4c362065a6b95ff952c0eab010f04dcd2c3494e813b493ecfd4fcb9fc0d8","impliedFormat":1},{"version":"68d73b4a11549f9c0b7d352d10e91e5dca8faa3322bfb77b661839c42b1ddec7","impliedFormat":1},{"version":"5efce4fc3c29ea84e8928f97adec086e3dc876365e0982cc8479a07954a3efd4","impliedFormat":1},{"version":"feecb1be483ed332fad555aff858affd90a48ab19ba7272ee084704eb7167569","impliedFormat":1},{"version":"ee7bad0c15b58988daa84371e0b89d313b762ab83cb5b31b8a2d1162e8eb41c2","impliedFormat":1},{"version":"27bdc30a0e32783366a5abeda841bc22757c1797de8681bbe81fbc735eeb1c10","impliedFormat":1},{"version":"8fd575e12870e9944c7e1d62e1f5a73fcf23dd8d3a321f2a2c74c20d022283fe","impliedFormat":1},{"version":"8bf8b5e44e3c9c36f98e1007e8b7018c0f38d8adc07aecef42f5200114547c70","impliedFormat":1},{"version":"092c2bfe125ce69dbb1223c85d68d4d2397d7d8411867b5cc03cec902c233763","affectsGlobalScope":true,"impliedFormat":1},{"version":"c57796738e7f83dbc4b8e65132f11a377649c00dd3eee333f672b8f0a6bea671","affectsGlobalScope":true,"impliedFormat":1},{"version":"dc2df20b1bcdc8c2d34af4926e2c3ab15ffe1160a63e58b7e09833f616efff44","affectsGlobalScope":true,"impliedFormat":1},{"version":"515d0b7b9bea2e31ea4ec968e9edd2c39d3eebf4a2d5cbd04e88639819ae3b71","affectsGlobalScope":true,"impliedFormat":1},{"version":"0559b1f683ac7505ae451f9a96ce4c3c92bdc71411651ca6ddb0e88baaaad6a3","affectsGlobalScope":true,"impliedFormat":1},{"version":"0dc1e7ceda9b8b9b455c3a2d67b0412feab00bd2f66656cd8850e8831b08b537","affectsGlobalScope":true,"impliedFormat":1},{"version":"ce691fb9e5c64efb9547083e4a34091bcbe5bdb41027e310ebba8f7d96a98671","affectsGlobalScope":true,"impliedFormat":1},{"version":"8d697a2a929a5fcb38b7a65594020fcef05ec1630804a33748829c5ff53640d0","affectsGlobalScope":true,"impliedFormat":1},{"version":"4ff2a353abf8a80ee399af572debb8faab2d33ad38c4b4474cff7f26e7653b8d","affectsGlobalScope":true,"impliedFormat":1},{"version":"936e80ad36a2ee83fc3caf008e7c4c5afe45b3cf3d5c24408f039c1d47bdc1df","affectsGlobalScope":true,"impliedFormat":1},{"version":"d15bea3d62cbbdb9797079416b8ac375ae99162a7fba5de2c6c505446486ac0a","affectsGlobalScope":true,"impliedFormat":1},{"version":"68d18b664c9d32a7336a70235958b8997ebc1c3b8505f4f1ae2b7e7753b87618","affectsGlobalScope":true,"impliedFormat":1},{"version":"eb3d66c8327153d8fa7dd03f9c58d351107fe824c79e9b56b462935176cdf12a","affectsGlobalScope":true,"impliedFormat":1},{"version":"38f0219c9e23c915ef9790ab1d680440d95419ad264816fa15009a8851e79119","affectsGlobalScope":true,"impliedFormat":1},{"version":"69ab18c3b76cd9b1be3d188eaf8bba06112ebbe2f47f6c322b5105a6fbc45a2e","affectsGlobalScope":true,"impliedFormat":1},{"version":"fef8cfad2e2dc5f5b3d97a6f4f2e92848eb1b88e897bb7318cef0e2820bceaab","affectsGlobalScope":true,"impliedFormat":1},{"version":"2f11ff796926e0832f9ae148008138ad583bd181899ab7dd768a2666700b1893","affectsGlobalScope":true,"impliedFormat":1},{"version":"4de680d5bb41c17f7f68e0419412ca23c98d5749dcaaea1896172f06435891fc","affectsGlobalScope":true,"impliedFormat":1},{"version":"954296b30da6d508a104a3a0b5d96b76495c709785c1d11610908e63481ee667","affectsGlobalScope":true,"impliedFormat":1},{"version":"ac9538681b19688c8eae65811b329d3744af679e0bdfa5d842d0e32524c73e1c","affectsGlobalScope":true,"impliedFormat":1},{"version":"0a969edff4bd52585473d24995c5ef223f6652d6ef46193309b3921d65dd4376","affectsGlobalScope":true,"impliedFormat":1},{"version":"9e9fbd7030c440b33d021da145d3232984c8bb7916f277e8ffd3dc2e3eae2bdb","affectsGlobalScope":true,"impliedFormat":1},{"version":"811ec78f7fefcabbda4bfa93b3eb67d9ae166ef95f9bff989d964061cbf81a0c","affectsGlobalScope":true,"impliedFormat":1},{"version":"717937616a17072082152a2ef351cb51f98802fb4b2fdabd32399843875974ca","affectsGlobalScope":true,"impliedFormat":1},{"version":"d7e7d9b7b50e5f22c915b525acc5a49a7a6584cf8f62d0569e557c5cfc4b2ac2","affectsGlobalScope":true,"impliedFormat":1},{"version":"71c37f4c9543f31dfced6c7840e068c5a5aacb7b89111a4364b1d5276b852557","affectsGlobalScope":true,"impliedFormat":1},{"version":"576711e016cf4f1804676043e6a0a5414252560eb57de9faceee34d79798c850","affectsGlobalScope":true,"impliedFormat":1},{"version":"89c1b1281ba7b8a96efc676b11b264de7a8374c5ea1e6617f11880a13fc56dc6","affectsGlobalScope":true,"impliedFormat":1},{"version":"74f7fa2d027d5b33eb0471c8e82a6c87216223181ec31247c357a3e8e2fddc5b","affectsGlobalScope":true,"impliedFormat":1},{"version":"d6d7ae4d1f1f3772e2a3cde568ed08991a8ae34a080ff1151af28b7f798e22ca","affectsGlobalScope":true,"impliedFormat":1},{"version":"063600664504610fe3e99b717a1223f8b1900087fab0b4cad1496a114744f8df","affectsGlobalScope":true,"impliedFormat":1},{"version":"934019d7e3c81950f9a8426d093458b65d5aff2c7c1511233c0fd5b941e608ab","affectsGlobalScope":true,"impliedFormat":1},{"version":"52ada8e0b6e0482b728070b7639ee42e83a9b1c22d205992756fe020fd9f4a47","affectsGlobalScope":true,"impliedFormat":1},{"version":"3bdefe1bfd4d6dee0e26f928f93ccc128f1b64d5d501ff4a8cf3c6371200e5e6","affectsGlobalScope":true,"impliedFormat":1},{"version":"59fb2c069260b4ba00b5643b907ef5d5341b167e7d1dbf58dfd895658bda2867","affectsGlobalScope":true,"impliedFormat":1},{"version":"639e512c0dfc3fad96a84caad71b8834d66329a1f28dc95e3946c9b58176c73a","affectsGlobalScope":true,"impliedFormat":1},{"version":"368af93f74c9c932edd84c58883e736c9e3d53cec1fe24c0b0ff451f529ceab1","affectsGlobalScope":true,"impliedFormat":1},{"version":"af3dd424cf267428f30ccfc376f47a2c0114546b55c44d8c0f1d57d841e28d74","affectsGlobalScope":true,"impliedFormat":1},{"version":"995c005ab91a498455ea8dfb63aa9f83fa2ea793c3d8aa344be4a1678d06d399","affectsGlobalScope":true,"impliedFormat":1},{"version":"959d36cddf5e7d572a65045b876f2956c973a586da58e5d26cde519184fd9b8a","affectsGlobalScope":true,"impliedFormat":1},{"version":"965f36eae237dd74e6cca203a43e9ca801ce38824ead814728a2807b1910117d","affectsGlobalScope":true,"impliedFormat":1},{"version":"3925a6c820dcb1a06506c90b1577db1fdbf7705d65b62b99dce4be75c637e26b","affectsGlobalScope":true,"impliedFormat":1},{"version":"0a3d63ef2b853447ec4f749d3f368ce642264246e02911fcb1590d8c161b8005","affectsGlobalScope":true,"impliedFormat":1},{"version":"b5ce7a470bc3628408429040c4e3a53a27755022a32fd05e2cb694e7015386c7","affectsGlobalScope":true,"impliedFormat":1},{"version":"8444af78980e3b20b49324f4a16ba35024fef3ee069a0eb67616ea6ca821c47a","affectsGlobalScope":true,"impliedFormat":1},{"version":"3287d9d085fbd618c3971944b65b4be57859f5415f495b33a6adc994edd2f004","affectsGlobalScope":true,"impliedFormat":1},{"version":"b4b67b1a91182421f5df999988c690f14d813b9850b40acd06ed44691f6727ad","affectsGlobalScope":true,"impliedFormat":1},{"version":"df83c2a6c73228b625b0beb6669c7ee2a09c914637e2d35170723ad49c0f5cd4","affectsGlobalScope":true,"impliedFormat":1},{"version":"436aaf437562f276ec2ddbee2f2cdedac7664c1e4c1d2c36839ddd582eeb3d0a","affectsGlobalScope":true,"impliedFormat":1},{"version":"8e3c06ea092138bf9fa5e874a1fdbc9d54805d074bee1de31b99a11e2fec239d","affectsGlobalScope":true,"impliedFormat":1},{"version":"87dc0f382502f5bbce5129bdc0aea21e19a3abbc19259e0b43ae038a9fc4e326","affectsGlobalScope":true,"impliedFormat":1},{"version":"b1cb28af0c891c8c96b2d6b7be76bd394fddcfdb4709a20ba05a7c1605eea0f9","affectsGlobalScope":true,"impliedFormat":1},{"version":"2fef54945a13095fdb9b84f705f2b5994597640c46afeb2ce78352fab4cb3279","affectsGlobalScope":true,"impliedFormat":1},{"version":"ac77cb3e8c6d3565793eb90a8373ee8033146315a3dbead3bde8db5eaf5e5ec6","affectsGlobalScope":true,"impliedFormat":1},{"version":"56e4ed5aab5f5920980066a9409bfaf53e6d21d3f8d020c17e4de584d29600ad","affectsGlobalScope":true,"impliedFormat":1},{"version":"4ece9f17b3866cc077099c73f4983bddbcb1dc7ddb943227f1ec070f529dedd1","affectsGlobalScope":true,"impliedFormat":1},{"version":"0a6282c8827e4b9a95f4bf4f5c205673ada31b982f50572d27103df8ceb8013c","affectsGlobalScope":true,"impliedFormat":1},{"version":"1c9319a09485199c1f7b0498f2988d6d2249793ef67edda49d1e584746be9032","affectsGlobalScope":true,"impliedFormat":1},{"version":"e3a2a0cee0f03ffdde24d89660eba2685bfbdeae955a6c67e8c4c9fd28928eeb","affectsGlobalScope":true,"impliedFormat":1},{"version":"811c71eee4aa0ac5f7adf713323a5c41b0cf6c4e17367a34fbce379e12bbf0a4","affectsGlobalScope":true,"impliedFormat":1},{"version":"51ad4c928303041605b4d7ae32e0c1ee387d43a24cd6f1ebf4a2699e1076d4fa","affectsGlobalScope":true,"impliedFormat":1},{"version":"60037901da1a425516449b9a20073aa03386cce92f7a1fd902d7602be3a7c2e9","affectsGlobalScope":true,"impliedFormat":1},{"version":"d4b1d2c51d058fc21ec2629fff7a76249dec2e36e12960ea056e3ef89174080f","affectsGlobalScope":true,"impliedFormat":1},{"version":"22adec94ef7047a6c9d1af3cb96be87a335908bf9ef386ae9fd50eeb37f44c47","affectsGlobalScope":true,"impliedFormat":1},{"version":"4245fee526a7d1754529d19227ecbf3be066ff79ebb6a380d78e41648f2f224d","affectsGlobalScope":true,"impliedFormat":1},{"version":"8e7f8264d0fb4c5339605a15daadb037bf238c10b654bb3eee14208f860a32ea","affectsGlobalScope":true,"impliedFormat":1},{"version":"782dec38049b92d4e85c1585fbea5474a219c6984a35b004963b00beb1aab538","affectsGlobalScope":true,"impliedFormat":1},{"version":"8c51b09def07d64dc1f975abbd73b7017c6e3a377f34f3aaea5abe1cb00779c1","affectsGlobalScope":true},{"version":"70521b6ab0dcba37539e5303104f29b721bfb2940b2776da4cc818c07e1fefc1","affectsGlobalScope":true,"impliedFormat":1},{"version":"ab41ef1f2cdafb8df48be20cd969d875602483859dc194e9c97c8a576892c052","affectsGlobalScope":true,"impliedFormat":1},{"version":"d153a11543fd884b596587ccd97aebbeed950b26933ee000f94009f1ab142848","affectsGlobalScope":true,"impliedFormat":1},{"version":"21d819c173c0cf7cc3ce57c3276e77fd9a8a01d35a06ad87158781515c9a438a","impliedFormat":1},{"version":"a79e62f1e20467e11a904399b8b18b18c0c6eea6b50c1168bf215356d5bebfaf","affectsGlobalScope":true,"impliedFormat":1},{"version":"6b80c6175da9de59bace50a72c2d68490d4ab5b07016ff5367bc7ba33cf2f219","affectsGlobalScope":true,"impliedFormat":1},{"version":"8e9c23ba78aabc2e0a27033f18737a6df754067731e69dc5f52823957d60a4b6","impliedFormat":1},{"version":"5929864ce17fba74232584d90cb721a89b7ad277220627cc97054ba15a98ea8f","impliedFormat":1},{"version":"24bd580b5743dc56402c440dc7f9a4f5d592ad7a419f25414d37a7bfe11e342b","impliedFormat":1},{"version":"25c8056edf4314820382a5fdb4bb7816999acdcb929c8f75e3f39473b87e85bc","impliedFormat":1},{"version":"c464d66b20788266e5353b48dc4aa6bc0dc4a707276df1e7152ab0c9ae21fad8","impliedFormat":1},{"version":"78d0d27c130d35c60b5e5566c9f1e5be77caf39804636bc1a40133919a949f21","impliedFormat":1},{"version":"c6fd2c5a395f2432786c9cb8deb870b9b0e8ff7e22c029954fabdd692bff6195","impliedFormat":1},{"version":"1d6e127068ea8e104a912e42fc0a110e2aa5a66a356a917a163e8cf9a65e4a75","impliedFormat":1},{"version":"5ded6427296cdf3b9542de4471d2aa8d3983671d4cac0f4bf9c637208d1ced43","impliedFormat":1},{"version":"6bdc71028db658243775263e93a7db2fd2abfce3ca569c3cca5aee6ed5eb186d","impliedFormat":1},{"version":"cadc8aced301244057c4e7e73fbcae534b0f5b12a37b150d80e5a45aa4bebcbd","impliedFormat":1},{"version":"385aab901643aa54e1c36f5ef3107913b10d1b5bb8cbcd933d4263b80a0d7f20","impliedFormat":1},{"version":"9670d44354bab9d9982eca21945686b5c24a3f893db73c0dae0fd74217a4c219","impliedFormat":1},{"version":"0b8a9268adaf4da35e7fa830c8981cfa22adbbe5b3f6f5ab91f6658899e657a7","impliedFormat":1},{"version":"11396ed8a44c02ab9798b7dca436009f866e8dae3c9c25e8c1fbc396880bf1bb","impliedFormat":1},{"version":"ba7bc87d01492633cb5a0e5da8a4a42a1c86270e7b3d2dea5d156828a84e4882","impliedFormat":1},{"version":"4893a895ea92c85345017a04ed427cbd6a1710453338df26881a6019432febdd","impliedFormat":1},{"version":"c21dc52e277bcfc75fac0436ccb75c204f9e1b3fa5e12729670910639f27343e","impliedFormat":1},{"version":"13f6f39e12b1518c6650bbb220c8985999020fe0f21d818e28f512b7771d00f9","impliedFormat":1},{"version":"9b5369969f6e7175740bf51223112ff209f94ba43ecd3bb09eefff9fd675624a","impliedFormat":1},{"version":"4fe9e626e7164748e8769bbf74b538e09607f07ed17c2f20af8d680ee49fc1da","impliedFormat":1},{"version":"24515859bc0b836719105bb6cc3d68255042a9f02a6022b3187948b204946bd2","impliedFormat":1},{"version":"ea0148f897b45a76544ae179784c95af1bd6721b8610af9ffa467a518a086a43","impliedFormat":1},{"version":"24c6a117721e606c9984335f71711877293a9651e44f59f3d21c1ea0856f9cc9","impliedFormat":1},{"version":"dd3273ead9fbde62a72949c97dbec2247ea08e0c6952e701a483d74ef92d6a17","impliedFormat":1},{"version":"405822be75ad3e4d162e07439bac80c6bcc6dbae1929e179cf467ec0b9ee4e2e","impliedFormat":1},{"version":"0db18c6e78ea846316c012478888f33c11ffadab9efd1cc8bcc12daded7a60b6","impliedFormat":1},{"version":"4d2b0eb911816f66abe4970898f97a2cfc902bcd743cbfa5017fad79f7ef90d8","impliedFormat":1},{"version":"bd0532fd6556073727d28da0edfd1736417a3f9f394877b6d5ef6ad88fba1d1a","impliedFormat":1},{"version":"89167d696a849fce5ca508032aabfe901c0868f833a8625d5a9c6e861ef935d2","impliedFormat":1},{"version":"e53a3c2a9f624d90f24bf4588aacd223e7bec1b9d0d479b68d2f4a9e6011147f","impliedFormat":1},{"version":"24b8685c62562f5d98615c5a0c1d05f297cf5065f15246edfe99e81ec4c0e011","impliedFormat":1},{"version":"93507c745e8f29090efb99399c3f77bec07db17acd75634249dc92f961573387","impliedFormat":1},{"version":"339dc5265ee5ed92e536a93a04c4ebbc2128f45eeec6ed29f379e0085283542c","impliedFormat":1},{"version":"4732aec92b20fb28c5fe9ad99521fb59974289ed1e45aecb282616202184064f","impliedFormat":1},{"version":"2e85db9e6fd73cfa3d7f28e0ab6b55417ea18931423bd47b409a96e4a169e8e6","impliedFormat":1},{"version":"c46e079fe54c76f95c67fb89081b3e399da2c7d109e7dca8e4b58d83e332e605","impliedFormat":1},{"version":"bf67d53d168abc1298888693338cb82854bdb2e69ef83f8a0092093c2d562107","impliedFormat":1},{"version":"08faa97886e71757779428dd4c69a545c32c85fd629d1116d42710b32c6378bc","affectsGlobalScope":true,"impliedFormat":1},{"version":"6b042aa5d277ad6963e2837179fd2f8fbb01968ac67115b0833c0244e93d1d50","impliedFormat":1},{"version":"7394959e5a741b185456e1ef5d64599c36c60a323207450991e7a42e08911419","impliedFormat":1},{"version":"3d77c73be94570813f8cadd1f05ebc3dc5e2e4fdefe4d340ca20cd018724ee36","impliedFormat":1},{"version":"23cfd70b42094e54cc3c5dab996d81b97e2b6f38ccb24ead85454b8ddfe2fc4f","affectsGlobalScope":true,"impliedFormat":1},{"version":"f3e58c4c18a031cbb17abec7a4ad0bd5ae9fc70c1f4ba1e7fb921ad87c504aca","impliedFormat":1},{"version":"a3e8bafb2af8e850c644f4be7f5156cf7d23b7bfdc3b786bd4d10ed40329649c","impliedFormat":1},{"version":"35ec8b6760fd7138bbf5809b84551e31028fb2ba7b6dc91d95d098bf212ca8b4","affectsGlobalScope":true,"impliedFormat":1},{"version":"5524481e56c48ff486f42926778c0a3cce1cc85dc46683b92b1271865bcf015a","impliedFormat":1},{"version":"4b87f767c7bc841511113c876a6b8bf1fd0cb0b718c888ad84478b372ec486b1","affectsGlobalScope":true,"impliedFormat":1},{"version":"8d04e3640dd9eb67f7f1e5bd3d0bf96c784666f7aefc8ac1537af6f2d38d4c29","impliedFormat":1},{"version":"3c884d9d9ec454bdf0d5a0b8465bf8297d2caa4d853851d92cc417ac6f30b969","impliedFormat":1},{"version":"5a369483ac4cfbdf0331c248deeb36140e6907db5e1daed241546b4a2055f82c","impliedFormat":1},{"version":"e8f5b5cc36615c17d330eaf8eebbc0d6bdd942c25991f96ef122f246f4ff722f","impliedFormat":1},{"version":"f0bd7e6d931657b59605c44112eaf8b980ba7f957a5051ed21cb93d978cf2f45","impliedFormat":1},{"version":"ee1ee365d88c4c6c0c0a5a5701d66ebc27ccd0bcfcfaa482c6e2e7fe7b98edf7","affectsGlobalScope":true,"impliedFormat":1},{"version":"0ada07543808f3b967624645a8e1ccd446f8b01ade47842acf1328aec899fed0","affectsGlobalScope":true,"impliedFormat":1},{"version":"0a37b8d00d03f0381d2db2fe31b0571dc9d7cc0f4b87ca103cc3cd2277690ba0","impliedFormat":1},{"version":"71adf5dbc59568663d252a46179e71e4d544c053978bfc526d11543a3f716f42","impliedFormat":1},{"version":"38bf8ff1b403c861e9052c9ea651cb4f38c1ecc084a34d79f8acc6d6477a7321","impliedFormat":1},{"version":"93bd413918fa921c8729cef45302b24d8b6c7855d72d5bf82d3972595ae8dcbf","impliedFormat":1},{"version":"4ff41188773cbf465807dd2f7059c7494cbee5115608efc297383832a1150c43","impliedFormat":1},{"version":"dccdf1677e531e33f8ac961a68bc537418c9a414797c1ea7e91307501cdc3f5e","impliedFormat":1},{"version":"e184c4b8918ef56c8c9e68bd79f3f3780e2d0d75bf2b8a41da1509a40c2deb46","affectsGlobalScope":true,"impliedFormat":1},{"version":"d206b4baf4ddcc15d9d69a9a2f4999a72a2c6adeaa8af20fa7a9960816287555","impliedFormat":1},{"version":"93f437e1398a4f06a984f441f7fa7a9f0535c04399619b5c22e0b87bdee182cb","impliedFormat":1},{"version":"afbe24ab0d74694372baa632ecb28bb375be53f3be53f9b07ecd7fc994907de5","impliedFormat":1},{"version":"70731d10d5311bd4cf710ef7f6539b62660f4b0bfdbb3f9fbe1d25fe6366a7fa","affectsGlobalScope":true,"impliedFormat":1},{"version":"6b19db3600a17af69d4f33d08cc7076a7d19fb65bb36e442cac58929ec7c9482","affectsGlobalScope":true,"impliedFormat":1},{"version":"9e043a1bc8fbf2a255bccf9bf27e0f1caf916c3b0518ea34aa72357c0afd42ec","impliedFormat":1},{"version":"137c2894e8f3e9672d401cc0a305dc7b1db7c69511cf6d3970fb53302f9eae09","impliedFormat":1},{"version":"3bc2f1e2c95c04048212c569ed38e338873f6a8593930cf5a7ef24ffb38fc3b6","impliedFormat":1},{"version":"8145e07aad6da5f23f2fcd8c8e4c5c13fb26ee986a79d03b0829b8fce152d8b2","impliedFormat":1},{"version":"f9d9d753d430ed050dc1bf2667a1bab711ccbb1c1507183d794cc195a5b085cc","impliedFormat":1},{"version":"9eece5e586312581ccd106d4853e861aaaa1a39f8e3ea672b8c3847eedd12f6e","impliedFormat":1},{"version":"ba1f814c22fd970255ddd60d61fb7e00c28271c933ab5d5cc19cd3ca66b8f57c","impliedFormat":1},{"version":"37ba7b45141a45ce6e80e66f2a96c8a5ab1bcef0fc2d0f56bb58df96ec67e972","impliedFormat":1},{"version":"125d792ec6c0c0f657d758055c494301cc5fdb327d9d9d5960b3f129aff76093","impliedFormat":1},{"version":"295f068af94245ee9d780555351bef98adfd58f8baf0b9dadbc31a489b881f8b","affectsGlobalScope":true,"impliedFormat":1},{"version":"1851a3b4db78664f83901bb9cac9e45e03a37bb5933cc5bf37e10bb7e91ab4eb","impliedFormat":1},{"version":"09d479208911ac3ac6a7c2fe86217fc1abe6c4f04e2d52e4890e500699eeab32","affectsGlobalScope":true,"impliedFormat":1},{"version":"12ed4559eba17cd977aa0db658d25c4047067444b51acfdcbf38470630642b23","affectsGlobalScope":true,"impliedFormat":1},{"version":"f3ffabc95802521e1e4bcba4c88d8615176dc6e09111d920c7a213bdda6e1d65","impliedFormat":1},{"version":"4f029899f9bae07e225c43aef893590541b2b43267383bf5e32e3a884d219ed5","impliedFormat":1},{"version":"ae56f65caf3be91108707bd8dfbccc2a57a91feb5daabf7165a06a945545ed26","impliedFormat":1},{"version":"a136d5de521da20f31631a0a96bf712370779d1c05b7015d7019a9b2a0446ca9","impliedFormat":1},{"version":"5b566927cad2ed2139655d55d690ffa87df378b956e7fe1c96024c4d9f75c4cf","affectsGlobalScope":true,"impliedFormat":1},{"version":"bce947017cb7a2deebcc4f5ba04cead891ce6ad1602a4438ae45ed9aa1f39104","affectsGlobalScope":true,"impliedFormat":1},{"version":"d3dffd70e6375b872f0b4e152de4ae682d762c61a24881ecc5eb9f04c5caf76f","impliedFormat":1},{"version":"e2c72c065a36bc9ab2a00ac6a6f51e71501619a72c0609defd304d46610487a4","impliedFormat":1},{"version":"d91a7d8b5655c42986f1bdfe2105c4408f472831c8f20cf11a8c3345b6b56c8c","impliedFormat":1},{"version":"616075a6ac578cf5a013ee12964188b4412823796ce0b202c6f1d2e4ca8480d7","affectsGlobalScope":true,"impliedFormat":1},{"version":"e8a979b8af001c9fc2e774e7809d233c8ca955a28756f52ee5dee88ccb0611d2","impliedFormat":1},{"version":"cac793cc47c29e26e4ac3601dcb00b4435ebed26203485790e44f2ad8b6ad847","impliedFormat":1},{"version":"deecdc1f3f5ea9548ef73774f412c7af489afeb7dca1c394b5add10e929aff42","affectsGlobalScope":true,"impliedFormat":1},{"version":"f0bb8c099438ad08fc589906658b01e8745b5d836d0bb95b1c70a232ed7340cd","impliedFormat":1},{"version":"1a35b02330e6a5ae12eb0c2d5f70f80a19d7d9fe579a05e14553f737280b0483","signature":"8e609bb71c20b858c77f0e9f90bb1319db8477b13f9f965f1a1e18524bf50881"},{"version":"91850e1c4aca46b4a9527871fde3f410ff65660d7fa0bc12359ef2455ebadc69","signature":"71870cb9027e93dba72421f68314390f37964c72f4a270eda61139b1e8a5a4e5"},{"version":"886b57a4fa63b851930a1f3f64f04616b672363b2823756c484e8f9f31823fec","signature":"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"},{"version":"d50ab0815120231ab511558a753c33b2806b42cabe006356fb0bb763fc30e865","impliedFormat":1},{"version":"b6d03c9cfe2cf0ba4c673c209fcd7c46c815b2619fd2aad59fc4229aaef2ed43","impliedFormat":1},{"version":"32ddc6ad753ae79571bbf28cebff7a383bf7f562ac5ef5d25c94ef7f71609d49","impliedFormat":1},{"version":"670a76db379b27c8ff42f1ba927828a22862e2ab0b0908e38b671f0e912cc5ed","impliedFormat":1},{"version":"81df92841a7a12d551fcbc7e4e83dbb7d54e0c73f33a82162d13e9ae89700079","impliedFormat":1},{"version":"069bebfee29864e3955378107e243508b163e77ab10de6a5ee03ae06939f0bb9","impliedFormat":1},{"version":"42baf4ca38c38deaf411ea73f37bc39ff56c6e5c761a968b64ac1b25c92b5cd8","impliedFormat":1},{"version":"d7dbe0ad36bdca8a6ecf143422a48e72cc8927bab7b23a1a2485c2f78a7022c6","impliedFormat":1},{"version":"8718fa41d7cf4aa91de4e8f164c90f88e0bf343aa92a1b9b725a9c675c64e16b","impliedFormat":1},{"version":"f992cd6cc0bcbaa4e6c810468c90f2d8595f8c6c3cf050c806397d3de8585562","impliedFormat":1},{"version":"fb893a0dfc3c9fb0f9ca93d0648694dd95f33cbad2c0f2c629f842981dfd4e2e","impliedFormat":1},{"version":"3eb11dbf3489064a47a2e1cf9d261b1f100ef0b3b50ffca6c44dd99d6dd81ac1","impliedFormat":1},{"version":"e2b48abff5a8adc6bb1cd13a702b9ef05e6045a98e7cfa95a8779b53b6d0e69d","impliedFormat":1},{"version":"ed19da84b7dbf00952ad0b98ce5c194f1903bcf7c94d8103e8e0d63b271543ae","impliedFormat":1},{"version":"fec943fdb3275eb6e006b35e04a8e2e99e9adf3f4b969ddf15315ac7575a93e4","impliedFormat":1},{"version":"65ff5a0aefd7817a03c1ad04fee85c9cdd3ec415cc3c9efec85d8008d4d5e4ee","impliedFormat":1},{"version":"36a2e4c9a67439aca5f91bb304611d5ae6e20d420503e96c230cf8fcdc948d94","affectsGlobalScope":true,"impliedFormat":1},{"version":"8a8eb4ebffd85e589a1cc7c178e291626c359543403d58c9cd22b81fab5b1fb9","impliedFormat":1},{"version":"b2546f0fbeae6ef5e232c04100e1d8c49d36d1fff8e4755f663a3e3f06e7f2d6","affectsGlobalScope":true,"impliedFormat":1},{"version":"17ed71200119e86ccef2d96b73b02ce8854b76ad6bd21b5021d4269bec527b5f","impliedFormat":1},{"version":"74d5a87c3616cd5d8691059d531504403aa857e09cbaecb1c64dfb9ace0db185","impliedFormat":1},{"version":"104c67f0da1bdf0d94865419247e20eded83ce7f9911a1aa75fc675c077ca66e","impliedFormat":1},{"version":"cc0d0b339f31ce0ab3b7a5b714d8e578ce698f1e13d7f8c60bfb766baeb1d35c","impliedFormat":1},{"version":"f9e22729fa06ed20f8b1fe60670b7c74933fdfd44d869ddfb1919c15a5cf12fb","impliedFormat":1},{"version":"d3f2d715f57df3f04bf7b16dde01dec10366f64fce44503c92b8f78f614c1769","impliedFormat":1},{"version":"b78cd10245a90e27e62d0558564f5d9a16576294eee724a59ae21b91f9269e4a","impliedFormat":1},{"version":"936eb43a381712a8ec1249f2afc819f6fc7ca68f10dfec71762b428dfdc53bf1","impliedFormat":1},{"version":"2f5747b1508ccf83fad0c251ba1e5da2f5a30b78b09ffa1cfaf633045160afed","impliedFormat":1},{"version":"86ea91bfa7fef1eeb958056f30f1db4e0680bc9b5132e5e9d6e9cfd773c0c4fd","affectsGlobalScope":true,"impliedFormat":1},{"version":"689be50b735f145624c6f391042155ae2ff6b90a93bac11ca5712bc866f6010c","impliedFormat":1},{"version":"785b9d575b49124ce01b46f5b9402157c7611e6532effa562ac6aebec0074dfc","impliedFormat":1},{"version":"f3d8c757e148ad968f0d98697987db363070abada5f503da3c06aefd9d4248c1","impliedFormat":1},{"version":"a4a39b5714adfcadd3bbea6698ca2e942606d833bde62ad5fb6ec55f5e438ff8","impliedFormat":1},{"version":"bbc1d029093135d7d9bfa4b38cbf8761db505026cc458b5e9c8b74f4000e5e75","impliedFormat":1},{"version":"1f68ab0e055994eb337b67aa87d2a15e0200951e9664959b3866ee6f6b11a0fe","impliedFormat":1},{"version":"b71c603a539078a5e3a039b20f2b0a0d1708967530cf97dec8850a9ca45baa2b","impliedFormat":1},{"version":"0e13570a7e86c6d83dd92e81758a930f63747483e2cd34ef36fcdb47d1f9726a","impliedFormat":1},{"version":"a45c25e77c911c1f2a04cade78f6f42b4d7d896a3882d4e226efd3a3fcd5f2c4","affectsGlobalScope":true,"impliedFormat":1},{"version":"5c45abf1e13e4463eacfd5dedda06855da8748a6a6cb3334f582b52e219acc04","impliedFormat":1},{"version":"963d59066dd6742da1918a6213a209bcc205b8ee53b1876ee2b4e6d80f97c85e","impliedFormat":1},{"version":"fd326577c62145816fe1acc306c734c2396487f76719d3785d4e825b34540b33","impliedFormat":1},{"version":"afe73051ff6a03a9565cbd8ebb0e956ee3df5e913ad5c1ded64218aabfa3dcb5","impliedFormat":1},{"version":"ee65fe452abe1309389c5f50710f24114e08a302d40708101c4aa950a2a7d044","impliedFormat":1},{"version":"63786b6f821dee19eb898afb385bd58f1846e6cba593a35edcf9631ace09ba25","impliedFormat":1},{"version":"035a5df183489c2e22f3cf59fc1ed2b043d27f357eecc0eb8d8e840059d44245","impliedFormat":1},{"version":"a4809f4d92317535e6b22b01019437030077a76fec1d93b9881c9ed4738fcc54","impliedFormat":1},{"version":"5f53fa0bd22096d2a78533f94e02c899143b8f0f9891a46965294ee8b91a9434","impliedFormat":1},{"version":"8b5402ae709d042c3530ed3506c135a967159f42aed3221267e70c5b7240b577","impliedFormat":1},{"version":"868c78a84ad3530fc1b6e03da4611405da111bbfb0f1480abe45e801cde0b995","impliedFormat":1},{"version":"ddef25f825320de051dcb0e62ffce621b41c67712b5b4105740c32fd83f4c449","impliedFormat":1},{"version":"1b3dffaa4ca8e38ac434856843505af767a614d187fb3a5ef4fcebb023c355aa","impliedFormat":1},{"version":"ab82804a14454734010dcdcd43f564ff7b0389bee4c5692eec76ff5b30d4cf66","impliedFormat":1},{"version":"eb15edfcef078300657e1d5d678e1944b3518c2dd8f26792fdba2fe29f73d32b","impliedFormat":1},{"version":"bae8d023ef6b23df7da26f51cea44321f95817c190342a36882e93b80d07a960","impliedFormat":1},{"version":"26a770cec4bd2e7dbba95c6e536390fffe83c6268b78974a93727903b515c4e7","impliedFormat":1}],"root":[80,[181,183]],"options":{"allowImportingTsExtensions":false,"composite":true,"esModuleInterop":true,"module":1,"outDir":"./dist-electron","rootDir":"./src","skipLibCheck":false,"strict":true,"target":99},"referencedMap":[[186,1],[184,2],[189,3],[185,1],[187,4],[188,1],[193,5],[195,6],[196,2],[197,7],[191,2],[198,8],[194,2],[126,9],[127,9],[128,10],[86,11],[129,12],[130,13],[131,14],[81,2],[84,15],[82,2],[83,2],[132,16],[133,17],[134,18],[135,19],[136,20],[137,21],[138,21],[140,22],[139,23],[141,24],[142,25],[143,26],[125,27],[85,2],[144,28],[145,29],[146,30],[178,31],[147,32],[148,33],[149,34],[150,35],[151,36],[152,37],[153,38],[154,39],[155,40],[156,41],[157,41],[158,42],[159,2],[160,43],[162,44],[161,45],[163,46],[164,47],[165,48],[166,49],[167,50],[168,51],[169,52],[170,53],[171,54],[172,55],[173,56],[174,57],[175,58],[176,59],[177,60],[199,2],[203,61],[200,2],[202,62],[192,63],[204,64],[87,2],[201,2],[179,65],[190,22],[180,2],[78,2],[79,2],[13,2],[15,2],[14,2],[2,2],[16,2],[17,2],[18,2],[19,2],[20,2],[21,2],[22,2],[23,2],[3,2],[24,2],[25,2],[4,2],[26,2],[30,2],[27,2],[28,2],[29,2],[31,2],[32,2],[33,2],[5,2],[34,2],[35,2],[36,2],[37,2],[6,2],[41,2],[38,2],[39,2],[40,2],[42,2],[7,2],[43,2],[48,2],[49,2],[44,2],[45,2],[46,2],[47,2],[8,2],[53,2],[50,2],[51,2],[52,2],[54,2],[9,2],[55,2],[56,2],[57,2],[59,2],[58,2],[60,2],[61,2],[10,2],[62,2],[63,2],[64,2],[11,2],[65,2],[66,2],[67,2],[68,2],[69,2],[1,2],[70,2],[71,2],[12,2],[75,2],[73,2],[77,2],[72,2],[76,2],[74,2],[103,66],[113,67],[102,66],[123,68],[94,69],[93,70],[122,71],[116,72],[121,73],[96,74],[110,75],[95,76],[119,77],[91,78],[90,71],[120,79],[92,80],[97,81],[98,2],[101,81],[88,2],[124,82],[114,83],[105,84],[106,85],[108,86],[104,87],[107,88],[117,71],[99,89],[100,90],[109,91],[89,92],[112,83],[111,81],[115,2],[118,93],[80,2],[181,94],[182,95],[183,2],[206,96],[207,97],[213,98],[205,99],[218,100],[217,101],[216,102],[214,2],[212,103],[222,104],[221,103],[224,105],[225,7],[226,2],[219,2],[227,106],[228,2],[229,107],[230,108],[215,2],[208,2],[223,2],[231,71],[210,2],[211,2],[232,2],[209,109],[233,110],[220,111],[234,99],[235,2],[236,112],[237,2],[238,113]],"latestChangedDtsFile":"./dist-electron/preload/index.d.ts","version":"5.8.3"}
--- END FILE: tsconfig.node.tsbuildinfo ---

--- START FILE: tsconfig.json ---
// tsconfig.json (Base config)
{
    "compilerOptions": {
      "target": "ESNext",
      "lib": ["DOM", "DOM.Iterable", "ESNext"],
      "module": "ESNext",
      "skipLibCheck": true,
      "moduleResolution": "bundler",
      "allowImportingTsExtensions": true,
      "resolveJsonModule": true,
      "isolatedModules": true,
      "noEmit": true, // Renderer code emitted by Vite
      "jsx": "react-jsx",
      "esModuleInterop": true,
      "forceConsistentCasingInFileNames": true,
      "strict": true,
      "noUnusedLocals": true,
      "noUnusedParameters": true,
      "noFallthroughCasesInSwitch": true,
      "baseUrl": ".",
      "paths": {
        "@renderer/*": ["src/renderer/*"],
        "@main/*": ["src/main/*"],
        "@preload/*": ["src/preload/*"]
        //"@shared/*": ["src/shared/*"]
      }
    },
    "include": [
      "src/renderer/**/*.ts",
      "src/renderer/**/*.tsx",
      "src/renderer/vite-env.d.ts", // Adjusted path
      "src/shared.types.ts" // If it exists and is used by renderer
     ],
    "references": [{ "path": "./tsconfig.node.json" }] // Needs composite:true in node config
  }
--- END FILE: tsconfig.json ---

--- START FILE: vite.config.mjs ---
// vite.config.mjs
import { defineConfig } from 'vite';
import path from 'node:path';
import react from '@vitejs/plugin-react';
import monacoEditorPlugin from 'vite-plugin-monaco-editor'; // Standard import

// Define __dirname for ES module scope
import { fileURLToPath } from 'node:url';
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);


// Helper to access the actual plugin function, accounting for nested 'default'
const resolveMonacoPlugin = (pluginImport) => {
  // Check if the import itself is the function (ESM default export)
  if (typeof pluginImport === 'function') {
    return pluginImport;
  }
  // Check if it's nested under '.default' (CommonJS module imported by ESM)
  if (pluginImport && typeof pluginImport.default === 'function') {
    return pluginImport.default;
  }
  // If neither, throw an error or return the import hoping it works
  console.error("Could not resolve monaco editor plugin function!");
  return pluginImport; // Fallback, might still fail
};

const actualMonacoPlugin = resolveMonacoPlugin(monacoEditorPlugin);

export default defineConfig({
  plugins: [
    react(),

    // Use the resolved plugin function
    actualMonacoPlugin({
        // Plugin options
        // languages: ['json', 'css', 'html', 'typescript', 'javascript']
        // By default, it includes common languages like JS, TS, CSS, HTML, JSON
    })

  ],
  build: {
    outDir: 'dist/renderer', // Keep output directory for renderer code
    emptyOutDir: true, // Ensure the directory is cleaned before build
  },
  resolve: {
    alias: {
      // Ensure aliases match tsconfig.json paths
      '@renderer': path.resolve(__dirname, './src/renderer'),
      '@main': path.resolve(__dirname, './src/main'),
      '@preload': path.resolve(__dirname, './src/preload'),
      // '@shared': path.resolve(__dirname, './src/shared'), // Uncomment if needed
    },
  },
  root: '.', // Project root containing index.html
  base: './', // Use relative paths for Electron production build
  server: {
     // Optional server options like port
     // port: 3000, // Default is 5173
     strictPort: true, // Throw error if port is already in use
   },
  optimizeDeps: {
    // force: true // Generally remove 'force: true' unless deps are causing issues
  }
});
--- END FILE: vite.config.mjs ---

--- START FILE: src/renderer/contexts/ThemeContext.tsx ---
// --- START FILE: src/renderer/contexts/ThemeContext.tsx ---
// src/renderer/contexts/ThemeContext.tsx
import React, {
    createContext,
    useState,
    useContext,
    useEffect,
    ReactNode,
    useMemo,
  } from "react";
  
  // Add the new theme names here
  export type ThemeName =
    | "light"
    | "dark"
    | "win95"
    | "pipboy"
    | "mirc"
    | "qbasic"
    | "orange"
    | "cga"
    | "atari"
    | "snes"
    | "bw_tv";
  
  // Define base font sizes (can be adjusted)
  const BASE_FONT_SIZES = {
    ui: 14,
    editor: 12,
    terminal: 12,
  };
  
  // Define the shape of the context value
  interface ThemeContextProps {
    theme: ThemeName;
    setTheme: (theme: ThemeName) => void;
    fontSizeModifier: number; // e.g., -2, -1, 0, 1, 2 steps
    increaseFontSize: () => void;
    decreaseFontSize: () => void;
    resetFontSize: () => void;
  }
  
  const ThemeContext = createContext<ThemeContextProps | undefined>(undefined);
  
  interface ThemeProviderProps {
    children: ReactNode;
    defaultTheme?: ThemeName;
    defaultFontSizeModifier?: number;
  }
  
  const ALL_THEME_CLASSES = [ // Keep this potentially updated for cleanup, though dynamic removal works
    "theme-light",
    "theme-dark",
    "theme-win95",
    "theme-pipboy",
    "theme-mirc",
    "theme-qbasic",
    "theme-orange",
    "theme-cga",
    "theme-atari",
    "theme-snes",
    "theme-bw_tv",
  ];
  const FONT_SIZE_STEP = 1; // How many pixels each step changes
  const MAX_FONT_MODIFIER = 4; // Limit how large text can get
  const MIN_FONT_MODIFIER = -2; // Limit how small text can get
  
  export const ThemeProvider: React.FC<ThemeProviderProps> = ({
    children,
    defaultTheme = "dark",
    defaultFontSizeModifier = 0,
  }) => {
    const [theme, setTheme] = useState<ThemeName>(defaultTheme);
    const [fontSizeModifier, setFontSizeModifier] = useState<number>(
      defaultFontSizeModifier
    );
  
    // Apply Theme Class
    useEffect(() => {
      const rootElement = document.getElementById("root");
      if (rootElement) {
          // Remove all known theme classes before adding the new one
          const classesToRemove = ALL_THEME_CLASSES.filter(cls => rootElement.classList.contains(cls));
          if (classesToRemove.length > 0) {
              rootElement.classList.remove(...classesToRemove);
              document.body.classList.remove(...classesToRemove); // Also remove from body
          }
          // Add the current theme class
          rootElement.classList.add(`theme-${theme}`);
          document.body.classList.add(`theme-${theme}`); // Also apply to body
          console.log(`Theme applied: theme-${theme}`);
      }
  }, [theme]);
  
  
    // Apply Font Size CSS Variables
    useEffect(() => {
      const rootStyle = document.documentElement.style;
      const modifier = fontSizeModifier * FONT_SIZE_STEP;
  
      const uiSize = BASE_FONT_SIZES.ui + modifier;
      const editorSize = BASE_FONT_SIZES.editor + modifier;
      const terminalSize = BASE_FONT_SIZES.terminal + modifier;
  
      rootStyle.setProperty("--font-size-base", `${uiSize}px`);
      rootStyle.setProperty("--font-size-editor", `${editorSize}px`);
      rootStyle.setProperty("--font-size-terminal", `${terminalSize}px`);
  
      console.log(
        `Font sizes updated: Base=${uiSize}px, Editor=${editorSize}px, Terminal=${terminalSize}px`
      );
  
      // Trigger resize/reflow for editor/terminal if needed (optional)
      // This helps Monaco/Xterm recalculate layout with new font size
      window.dispatchEvent(new Event("resize"));
    }, [fontSizeModifier]);
  
    // Font size control functions
    const increaseFontSize = () => {
      setFontSizeModifier((prev) => Math.min(prev + 1, MAX_FONT_MODIFIER));
    };
    const decreaseFontSize = () => {
      setFontSizeModifier((prev) => Math.max(prev - 1, MIN_FONT_MODIFIER));
    };
    const resetFontSize = () => {
      setFontSizeModifier(0);
    };
  
    const contextValue = useMemo(
      () => ({
        theme,
        setTheme,
        fontSizeModifier,
        increaseFontSize,
        decreaseFontSize,
        resetFontSize,
      }),
      [theme, fontSizeModifier]
    ); // Include modifier in dependencies
  
    return (
      <ThemeContext.Provider value={contextValue}>
        {children}
      </ThemeContext.Provider>
    );
  };
  
  export const useTheme = (): ThemeContextProps => {
    // Rename to useSettings or similar later maybe
    const context = useContext(ThemeContext);
    if (context === undefined) {
      throw new Error("useTheme must be used within a ThemeProvider");
    }
    return context;
  };
  // --- END FILE: src/renderer/contexts/ThemeContext.tsx ---
--- END FILE: src/renderer/contexts/ThemeContext.tsx ---

--- START FILE: src/renderer/App.tsx ---
// src/renderer/App.tsx
import React from 'react';
import Sidebar from './components/Sidebar';
import MainPanel from './components/MainPanel';
import './App.css'; // Import the layout styles

// No theme logic needed directly here anymore, as ThemeProvider handles class application.
function App() {
  return (
    <div className="app-container"> {/* Root container for app layout */}
      <Sidebar />   {/* Sidebar component */}
      <MainPanel /> {/* Main content area (Editor + Terminal) */}
    </div>
  );
}

export default App;
--- END FILE: src/renderer/App.tsx ---

--- START FILE: src/renderer/vite-env.d.ts ---
// src/renderer/vite-env.d.ts
/// <reference types="vite/client" />

// Import the interface shape from the preload script
import type { ElectronAPI } from '@preload/index'; // Path alias should work

// Extend the global Window interface
declare global {
  interface Window {
    // Ensure this declaration EXACTLY matches the exported interface from preload
    electronAPI: ElectronAPI;
  }
}

// Make this file a module by exporting an empty object if it doesn't export anything else
// This helps prevent potential issues with global scope pollution in TypeScript.
export {};
--- END FILE: src/renderer/vite-env.d.ts ---

--- START FILE: src/renderer/main.tsx ---
// src/renderer/main.tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import { ThemeProvider } from './contexts/ThemeContext'; // Import the ThemeProvider
import './index.css'; // Ensure base styles are imported
import 'allotment/dist/style.css'; // <-- Ensure this import exists


const rootElement = document.getElementById('root');
if (!rootElement) throw new Error('Failed to find the root element');

const root = ReactDOM.createRoot(rootElement);
root.render(
  // Removed StrictMode for now as it can cause double useEffects in dev, which might confuse debugging
  // <React.StrictMode>
    <ThemeProvider defaultTheme="dark"> {/* Wrap App with ThemeProvider, set default */}
      <App />
    </ThemeProvider>
  // </React.StrictMode>
);
--- END FILE: src/renderer/main.tsx ---

--- START FILE: src/renderer/index.css ---
/* --- START FILE: src/renderer/index.css --- */
/* src/renderer/index.css */

/* --- FONT FACE DEFINITIONS (PLACEHOLDERS) --- */
/* You need to acquire and host these fonts appropriately */

/* Example for Pip-Boy style font */
/* @font-face {
  font-family: 'Overseer';
  src: url('/fonts/overseer-webfont.woff2') format('woff2'),
       url('/fonts/overseer-webfont.woff') format('woff');
  font-weight: normal;
  font-style: normal;
} */

/* Example for classic Windows font (use system fonts if available) */
/* @font-face {
  font-family: 'MS Sans Serif';
  src: local('Microsoft Sans Serif'), local('MS Sans Serif'); // Try local first
  // Add web font source if hosting it
  // src: url('/fonts/microsoft-sans-serif.woff2') format('woff2');
} */

/* --- END FONT FACE DEFINITIONS --- */


/* Define CSS Variables for the default theme (Light) */
:root {
  /* Font */
  --font-family-ui: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  --font-family-mono: Consolas, 'Courier New', monospace; /* More common monospace */
  --font-size-base: 14px;
  --font-size-sm: 0.875rem; /* 12px */
  --font-size-md: 1rem;    /* 14px */
  --font-size-lg: 1.125rem; /* 16px */
  --font-size-xl: 1.25rem;  /* 18px */
  --font-size-editor: var(--font-size-sm); /* Default editor size */
  --font-size-terminal: var(--font-size-sm); /* Default terminal size */

  /* Colors - Light Theme */
  --color-bg-app: #f8f8f8;
  --color-bg-sidebar: #ececec;
  --color-bg-main: #ffffff;
  --color-bg-editor: #ffffff; /* Monaco default light */
  --color-bg-terminal: #ffffff; /* Terminal default light */
  --color-bg-button: #e0e0e0;
  --color-bg-button-hover: #d6d6d6;
  --color-bg-button-active: #cccccc;
  --color-bg-input: #ffffff;
  --color-bg-dropdown: #ffffff;
  --color-bg-selected: #d5e5f6; /* A light blue for selections */
  --color-bg-hover: #ededed; /* General hover background */

  --color-text-primary: #1f1f1f;
  --color-text-secondary: #555555;
  --color-text-tertiary: #888888; /* For less important info */
  --color-text-terminal: #333333; /* Terminal default light */
  --color-text-heading: #000000;
  --color-text-button: #1f1f1f;
  --color-text-link: #0066cc;
  --color-text-link-hover: #004c99;
  --color-text-placeholder: #aaaaaa;
  --color-text-inverse: #ffffff; /* Text on dark backgrounds */
  --color-text-accent: #007acc; /* Accent color, e.g., focus ring */
  --color-text-error: #d9534f;

  --color-border: #cccccc;
  --color-border-accent: #aaaaaa;
  --color-border-input: #b0b0b0;
  --color-border-focus: #007acc; /* Use accent for focus */

  /* Spacing */
  --spacing-xxs: 2px;
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;

  /* Borders & Shadows */
  --border-radius-sm: 3px;
  --border-radius-md: 5px;
  --box-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
  --box-shadow-md: 0 3px 6px rgba(0, 0, 0, 0.15);
  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--color-border-input);
  --button-bevel-shadow: none; /* For aesthetic themes */

  /* Other UI Elements */
  --scrollbar-thumb-bg: #c1c1c1;
  --scrollbar-track-bg: #f1f1f1;

  /* Specific Component Variables (Examples) */
  --sidebar-width: 250px;
  --terminal-height: 200px;

  /* Theme Specific Overrides (Placeholders) */
  --scanline-opacity: 0;
  --crt-filter: none;
  --noise-opacity: 0;
  --win95-bevel-shadow-light: transparent;
  --win95-bevel-shadow-lighter: transparent;
  --win95-bevel-shadow-dark: transparent;
  --win95-bevel-shadow-darker: transparent;
}

/* Dark Theme */
.theme-dark {
  /* (Keep dark theme variables as before) */
  --font-family-ui: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  --font-family-mono: Consolas, 'Courier New', monospace;

  --color-bg-app: #1e1e1e;
  --color-bg-sidebar: #252526;
  --color-bg-main: #1e1e1e;
  --color-bg-editor: #1e1e1e;
  --color-bg-terminal: #1e1e1e;
  --color-bg-button: #3a3a3a;
  --color-bg-button-hover: #4a4a4a;
  --color-bg-button-active: #5a5a5a;
  --color-bg-input: #3c3c3c;
  --color-bg-dropdown: #3c3c3c;
  --color-bg-selected: #094771;
  --color-bg-hover: #2a2d2e;

  --color-text-primary: #d4d4d4;
  --color-text-secondary: #cccccc;
  --color-text-tertiary: #a0a0a0;
  --color-text-terminal: #cccccc;
  --color-text-heading: #ffffff;
  --color-text-button: #d4d4d4;
  --color-text-link: #3794ff;
  --color-text-link-hover: #60aaff;
  --color-text-placeholder: #777777;
  --color-text-inverse: #1f1f1f;
  --color-text-accent: #007acc;
  --color-text-error: #f48771;

  --color-border: #3f3f46;
  --color-border-accent: #505050;
  --color-border-input: #5f5f5f;
  --color-border-focus: #007acc;

  --scrollbar-thumb-bg: #555;
  --scrollbar-track-bg: #333;

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--color-border-input);
  --button-bevel-shadow: none;
}

/* Windows 95 Theme - Enhanced */
.theme-win95 {
  --font-family-ui: Tahoma, 'MS Sans Serif', 'Microsoft Sans Serif', system-ui, sans-serif; /* Prioritize classic fonts */
  --font-family-mono: 'Courier New', monospace;
  --font-size-base: 13px;
  --font-size-editor: 12px;
  --font-size-terminal: 12px;

  --color-bg-app: #c0c0c0;
  --color-bg-sidebar: #c0c0c0;
  --color-bg-main: #ffffff;
  --color-bg-editor: #ffffff;
  --color-bg-terminal: #000080; /* Classic blue console */
  --color-bg-button: #c0c0c0;
  --color-bg-button-hover: #c0c0c0;
  --color-bg-button-active: #b0b0b0; /* Slightly darker pressed */
  --color-bg-input: #ffffff;
  --color-bg-dropdown: #ffffff;
  --color-bg-selected: #000080;
  --color-bg-hover: #c0c0c0;

  --color-text-primary: #000000;
  --color-text-secondary: #000000;
  --color-text-tertiary: #808080;
  --color-text-terminal: #c0c0c0;
  --color-text-heading: #000000;
  --color-text-button: #000000;
  --color-text-link: #0000ff;
  --color-text-link-hover: #0000ff;
  --color-text-placeholder: #808080;
  --color-text-inverse: #ffffff; /* Text on selection bg */
  --color-text-accent: #000080;
  --color-text-error: #ff0000;

  --color-border: #808080;       /* Inner bevel dark gray */
  --color-border-accent: #ffffff; /* Outer bevel white */
  --color-border-dark: #000000;   /* Inner bevel black */
  --color-border-light: #dfdfdf; /* Outer bevel light gray */
  --color-border-input: #808080;
  --color-border-focus: #000000;

  --scrollbar-thumb-bg: #c0c0c0;
  --scrollbar-track-bg: #a0a0a0; /* Needs bevel styles */

  --border-standard: 1px solid var(--color-border); /* Use specific borders below */
  --border-radius-sm: 0; /* No rounded corners */
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;

  /* Bevel for buttons etc. - Use direct styles instead */
  --button-bevel-shadow: none; /* Will apply via direct CSS */

  /* Specific Bevel Colors */
  --win95-bevel-shadow-light: #ffffff;
  --win95-bevel-shadow-lighter: #dfdfdf;
  --win95-bevel-shadow-dark: #808080;
  --win95-bevel-shadow-darker: #0a0a0a;
}

/* Pip-Boy Theme */
.theme-pipboy {
  /* Assumes 'Overseer' font is loaded or replace with monospace */
  --font-family-ui: 'Overseer', Consolas, monospace;
  --font-family-mono: 'Overseer', Consolas, monospace;
  --font-size-base: 15px; /* Slightly larger, adjust as needed */
  --font-size-editor: 14px;
  --font-size-terminal: 14px;

  /* Pip-Boy Green */
  --pipboy-green: #15ff60;
  --pipboy-green-dark: #10b445;
  --pipboy-green-darker: #0a702a;
  --pipboy-bg: #0a1a0f; /* Very dark green/black */
  --pipboy-bg-lighter: #102a18;

  --color-bg-app: var(--pipboy-bg);
  --color-bg-sidebar: var(--pipboy-bg-lighter);
  --color-bg-main: var(--pipboy-bg);
  --color-bg-editor: var(--pipboy-bg);
  --color-bg-terminal: var(--pipboy-bg);
  --color-bg-button: transparent;
  --color-bg-button-hover: var(--pipboy-green-darker);
  --color-bg-button-active: var(--pipboy-green-dark);
  --color-bg-input: var(--pipboy-bg-lighter);
  --color-bg-dropdown: var(--pipboy-bg-lighter);
  --color-bg-selected: var(--pipboy-green-dark);
  --color-bg-hover: var(--pipboy-green-darker);

  --color-text-primary: var(--pipboy-green);
  --color-text-secondary: color-mix(in srgb, var(--pipboy-green) 70%, black);
  --color-text-tertiary: color-mix(in srgb, var(--pipboy-green) 50%, black);
  --color-text-terminal: var(--pipboy-green);
  --color-text-heading: var(--pipboy-green);
  --color-text-button: var(--pipboy-green);
  --color-text-link: var(--pipboy-green);
  --color-text-link-hover: color-mix(in srgb, var(--pipboy-green) 80%, white);
  --color-text-placeholder: var(--color-text-tertiary);
  --color-text-inverse: var(--pipboy-bg); /* Text on selection bg */
  --color-text-accent: var(--pipboy-green);
  --color-text-error: #ff5555; /* A contrasting red/orange */

  --color-border: var(--pipboy-green-dark);
  --color-border-accent: var(--pipboy-green);
  --color-border-input: var(--pipboy-green-dark);
  --color-border-focus: var(--pipboy-green);

  --scrollbar-thumb-bg: var(--pipboy-green-dark);
  --scrollbar-track-bg: var(--pipboy-bg-lighter);

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--color-border);
  --border-radius-sm: 0;
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none;

  /* Effects */
  --scanline-opacity: 0.15; /* Adjust opacity */
  --crt-filter: brightness(1.1) contrast(1.1); /* Basic CRT effect */
}

/* mIRC Inspired Theme (Refined) */
.theme-mirc {
  /* Classic Windows fonts */
  --font-family-ui: 'MS Sans Serif', Tahoma, system-ui, sans-serif;
  --font-family-mono: 'Courier New', monospace;
  --font-size-base: 13px;
  --font-size-editor: 12px;
  --font-size-terminal: 12px;

  /* mIRC often used system colors, very similar to Win95 */
  --color-bg-app: #c0c0c0;
  --color-bg-sidebar: #c0c0c0; /* Channel list area */
  --color-bg-main: #ffffff; /* Main chat/edit area */
  --color-bg-editor: #ffffff;
  --color-bg-terminal: #000000; /* Black usually for status/raw */
  --color-bg-button: #c0c0c0;
  --color-bg-button-hover: #c0c0c0;
  --color-bg-button-active: #b0b0b0;
  --color-bg-input: #ffffff; /* Input line */
  --color-bg-dropdown: #ffffff;
  --color-bg-selected: #000080;
  --color-bg-hover: #c0c0c0;

  --color-text-primary: #000000;
  --color-text-secondary: #000080; /* Often blue for links/commands */
  --color-text-tertiary: #808080;
  --color-text-terminal: #00ff00; /* Green text on black */
  --color-text-heading: #000000;
  --color-text-button: #000000;
  --color-text-link: #0000ff;
  --color-text-link-hover: #ff0000; /* Often red hover */
  --color-text-placeholder: #808080;
  --color-text-inverse: #ffffff;
  --color-text-accent: #000080;
  --color-text-error: #ff0000;

  --color-border: #808080;
  --color-border-accent: #ffffff;
  --color-border-input: #808080;
  --color-border-focus: #000000;
  --color-border-dark: #000000;
  --color-border-light: #dfdfdf;

  --scrollbar-thumb-bg: #c0c0c0;
  --scrollbar-track-bg: #a0a0a0;

  --border-standard: 1px solid var(--color-border);
  --border-radius-sm: 0;
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none; /* Use direct styles */

  --win95-bevel-shadow-light: #ffffff;
  --win95-bevel-shadow-lighter: #dfdfdf;
  --win95-bevel-shadow-dark: #808080;
  --win95-bevel-shadow-darker: #0a0a0a;
}


/* QBasic Theme */
.theme-qbasic {
  --font-family-ui: 'Courier New', monospace;
  --font-family-mono: 'Courier New', monospace;
  --font-size-base: 14px;
  --font-size-editor: 13px;
  --font-size-terminal: 13px;

  --qbasic-blue: #0000AA;
  --qbasic-white: #FFFFFF;
  --qbasic-yellow: #FFFF55;
  --qbasic-gray: #AAAAAA;
  --qbasic-dark-gray: #555555;

  --color-bg-app: var(--qbasic-blue);
  --color-bg-sidebar: var(--qbasic-dark-gray);
  --color-bg-main: var(--qbasic-blue);
  --color-bg-editor: var(--qbasic-blue);
  --color-bg-terminal: var(--qbasic-blue);
  --color-bg-button: var(--qbasic-gray);
  --color-bg-button-hover: #bbbbbb;
  --color-bg-button-active: #cccccc;
  --color-bg-input: var(--qbasic-dark-gray);
  --color-bg-dropdown: var(--qbasic-gray);
  --color-bg-selected: var(--qbasic-dark-gray);
  --color-bg-hover: #bbbbbb;

  --color-text-primary: var(--qbasic-yellow); /* Bright text */
  --color-text-secondary: var(--qbasic-white);
  --color-text-tertiary: var(--qbasic-gray);
  --color-text-terminal: var(--qbasic-yellow);
  --color-text-heading: var(--qbasic-white);
  --color-text-button: #000000; /* Black text on gray button */
  --color-text-link: var(--qbasic-yellow);
  --color-text-link-hover: var(--qbasic-white);
  --color-text-placeholder: var(--qbasic-gray);
  --color-text-inverse: var(--qbasic-white); /* Text on selection */
  --color-text-accent: var(--qbasic-yellow);
  --color-text-error: #FF5555;

  --color-border: var(--qbasic-gray);
  --color-border-accent: var(--qbasic-white);
  --color-border-input: var(--qbasic-gray);
  --color-border-focus: var(--qbasic-yellow);

  --scrollbar-thumb-bg: var(--qbasic-gray);
  --scrollbar-track-bg: var(--qbasic-dark-gray);

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--color-border);
  --border-radius-sm: 0;
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none;
}

/* Orange Monochrome Theme */
.theme-orange {
  --font-family-ui: 'Courier New', monospace;
  --font-family-mono: 'Courier New', monospace;
  --font-size-base: 14px;
  --font-size-editor: 13px;
  --font-size-terminal: 13px;

  --orange-bright: #FFA500; /* Bright Orange */
  --orange-medium: #D98C00; /* Slightly darker orange for borders/accents */
  --orange-dark: #201500; /* Very dark brown/black background */
  --orange-darker: #100A00;

  --color-bg-app: var(--orange-dark);
  --color-bg-sidebar: var(--orange-darker);
  --color-bg-main: var(--orange-dark);
  --color-bg-editor: var(--orange-dark);
  --color-bg-terminal: var(--orange-dark);
  --color-bg-button: transparent;
  --color-bg-button-hover: var(--orange-medium);
  --color-bg-button-active: var(--orange-bright);
  --color-bg-input: var(--orange-darker);
  --color-bg-dropdown: var(--orange-darker);
  --color-bg-selected: var(--orange-medium);
  --color-bg-hover: var(--orange-medium);

  --color-text-primary: var(--orange-bright);
  --color-text-secondary: color-mix(in srgb, var(--orange-bright) 70%, black);
  --color-text-tertiary: color-mix(in srgb, var(--orange-bright) 50%, black);
  --color-text-terminal: var(--orange-bright);
  --color-text-heading: var(--orange-bright);
  --color-text-button: var(--orange-bright);
  --color-text-link: var(--orange-bright);
  --color-text-link-hover: color-mix(in srgb, var(--orange-bright) 80%, white);
  --color-text-placeholder: var(--color-text-tertiary);
  --color-text-inverse: var(--orange-dark); /* Text on selection bg */
  --color-text-accent: var(--orange-bright);
  --color-text-error: #FF5555;

  --color-border: var(--orange-medium);
  --color-border-accent: var(--orange-bright);
  --color-border-input: var(--orange-medium);
  --color-border-focus: var(--orange-bright);

  --scrollbar-thumb-bg: var(--orange-medium);
  --scrollbar-track-bg: var(--orange-darker);

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--color-border);
  --border-radius-sm: 0;
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none;

  --scanline-opacity: 0.08;
  --crt-filter: brightness(1.05) contrast(1.05);
}

/* CGA Theme (Mode 4, Palette 1 inspired) */
.theme-cga {
  --font-family-ui: 'Courier New', monospace;
  --font-family-mono: 'Courier New', monospace;
  --font-size-base: 14px;
  --font-size-editor: 13px;
  --font-size-terminal: 13px;

  --cga-black: #000000;
  --cga-cyan: #55FFFF;
  --cga-magenta: #FF55FF;
  --cga-white: #FFFFFF;

  --color-bg-app: var(--cga-black);
  --color-bg-sidebar: #111111;
  --color-bg-main: var(--cga-black);
  --color-bg-editor: var(--cga-black);
  --color-bg-terminal: var(--cga-black);
  --color-bg-button: #222222;
  --color-bg-button-hover: #333333;
  --color-bg-button-active: #444444;
  --color-bg-input: #111111;
  --color-bg-dropdown: #222222;
  --color-bg-selected: var(--cga-cyan); /* Use a bright color for selection */
  --color-bg-hover: #333333;

  --color-text-primary: var(--cga-cyan); /* Cyan text */
  --color-text-secondary: var(--cga-magenta); /* Use magenta for secondary? */
  --color-text-tertiary: #AAAAAA; /* Gray for less important */
  --color-text-terminal: var(--cga-cyan);
  --color-text-heading: var(--cga-white);
  --color-text-button: var(--cga-white);
  --color-text-link: var(--cga-magenta);
  --color-text-link-hover: var(--cga-white);
  --color-text-placeholder: #555555;
  --color-text-inverse: var(--cga-black); /* Text on selection */
  --color-text-accent: var(--cga-cyan);
  --color-text-error: var(--cga-magenta); /* Use magenta for errors */

  --color-border: var(--cga-cyan);
  --color-border-accent: var(--cga-white);
  --color-border-input: #555555;
  --color-border-focus: var(--cga-white);

  --scrollbar-thumb-bg: #444444;
  --scrollbar-track-bg: #111111;

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid #555555;
  --border-radius-sm: 0;
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none;
}


/* Atari 2600 Theme */
.theme-atari {
  --font-family-ui: 'Courier New', monospace; /* Or ideally a blockier font */
  --font-family-mono: 'Courier New', monospace;
  --font-size-base: 14px;
  --font-size-editor: 13px;
  --font-size-terminal: 13px;

  --atari-black: #000000;
  --atari-cyan: #3FFFCF; /* Representative bright color */
  --atari-orange: #D87050;
  --atari-dk-gray: #444444;
  --atari-lt-gray: #AAAAAA;

  --color-bg-app: var(--atari-black);
  --color-bg-sidebar: #181818;
  --color-bg-main: var(--atari-black);
  --color-bg-editor: var(--atari-black);
  --color-bg-terminal: var(--atari-black);
  --color-bg-button: var(--atari-dk-gray);
  --color-bg-button-hover: #555555;
  --color-bg-button-active: #666666;
  --color-bg-input: #222222;
  --color-bg-dropdown: var(--atari-dk-gray);
  --color-bg-selected: var(--atari-orange); /* Orange selection */
  --color-bg-hover: #555555;

  --color-text-primary: var(--atari-cyan); /* Bright cyan text */
  --color-text-secondary: var(--atari-lt-gray);
  --color-text-tertiary: var(--atari-dk-gray);
  --color-text-terminal: var(--atari-cyan);
  --color-text-heading: var(--atari-orange);
  --color-text-button: var(--atari-lt-gray);
  --color-text-link: var(--atari-orange);
  --color-text-link-hover: var(--atari-cyan);
  --color-text-placeholder: var(--atari-dk-gray);
  --color-text-inverse: var(--atari-black); /* Text on selection */
  --color-text-accent: var(--atari-cyan);
  --color-text-error: var(--atari-orange); /* Use orange for errors */

  --color-border: var(--atari-dk-gray);
  --color-border-accent: var(--atari-cyan);
  --color-border-input: var(--atari-lt-gray);
  --color-border-focus: var(--atari-orange);

  --scrollbar-thumb-bg: #555555;
  --scrollbar-track-bg: #222222;

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--atari-lt-gray);
  --border-radius-sm: 0;
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none;
}

/* SNES Theme */
.theme-snes {
  --font-family-ui: system-ui, sans-serif; /* Less blocky */
  --font-family-mono: Consolas, 'Courier New', monospace;
  --font-size-base: 14px;
  --font-size-editor: 13px;
  --font-size-terminal: 13px;

  --snes-bg: #2F2F4F; /* Dark purplish gray */
  --snes-sidebar-bg: #3C3C5C;
  --snes-text: #E0E0FF; /* Light lavender text */
  --snes-accent1: #8080FF; /* Purple */
  --snes-accent2: #40C040; /* Green */
  --snes-accent3: #E04040; /* Red */
  --snes-accent4: #E0E040; /* Yellow */
  --snes-border: #505070;
  --snes-hover: #4A4A6A;

  --color-bg-app: var(--snes-bg);
  --color-bg-sidebar: var(--snes-sidebar-bg);
  --color-bg-main: var(--snes-bg);
  --color-bg-editor: var(--snes-bg);
  --color-bg-terminal: var(--snes-bg);
  --color-bg-button: var(--snes-sidebar-bg);
  --color-bg-button-hover: var(--snes-hover);
  --color-bg-button-active: var(--snes-accent1);
  --color-bg-input: var(--snes-sidebar-bg);
  --color-bg-dropdown: var(--snes-sidebar-bg);
  --color-bg-selected: var(--snes-accent1);
  --color-bg-hover: var(--snes-hover);

  --color-text-primary: var(--snes-text);
  --color-text-secondary: color-mix(in srgb, var(--snes-text) 80%, black);
  --color-text-tertiary: color-mix(in srgb, var(--snes-text) 60%, black);
  --color-text-terminal: var(--snes-text);
  --color-text-heading: var(--snes-accent4); /* Yellow heading */
  --color-text-button: var(--snes-text);
  --color-text-link: var(--snes-accent2); /* Green link */
  --color-text-link-hover: color-mix(in srgb, var(--snes-accent2) 80%, white);
  --color-text-placeholder: var(--color-text-tertiary);
  --color-text-inverse: var(--snes-bg); /* Text on selection */
  --color-text-accent: var(--snes-accent1);
  --color-text-error: var(--snes-accent3); /* Red error */

  --color-border: var(--snes-border);
  --color-border-accent: var(--snes-accent1);
  --color-border-input: var(--snes-border);
  --color-border-focus: var(--snes-accent2);

  --scrollbar-thumb-bg: var(--snes-hover);
  --scrollbar-track-bg: var(--snes-sidebar-bg);

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--snes-border);
  --border-radius-sm: 3px; /* Slightly rounded */
  --border-radius-md: 5px;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none;
}


/* B&W TV Theme */
.theme-bw_tv {
  --font-family-ui: 'Courier New', monospace;
  --font-family-mono: 'Courier New', monospace;
  --font-size-base: 14px;
  --font-size-editor: 13px;
  --font-size-terminal: 13px;

  --bw-black: #000000;
  --bw-dark-gray: #333333;
  --bw-gray: #888888;
  --bw-light-gray: #cccccc;
  --bw-white: #ffffff;

  --color-bg-app: var(--bw-black);
  --color-bg-sidebar: var(--bw-dark-gray);
  --color-bg-main: var(--bw-black);
  --color-bg-editor: var(--bw-black);
  --color-bg-terminal: var(--bw-black);
  --color-bg-button: var(--bw-gray);
  --color-bg-button-hover: var(--bw-light-gray);
  --color-bg-button-active: var(--bw-white);
  --color-bg-input: var(--bw-dark-gray);
  --color-bg-dropdown: var(--bw-gray);
  --color-bg-selected: var(--bw-light-gray);
  --color-bg-hover: var(--bw-gray);

  --color-text-primary: var(--bw-light-gray);
  --color-text-secondary: var(--bw-gray);
  --color-text-tertiary: var(--bw-dark-gray);
  --color-text-terminal: var(--bw-light-gray);
  --color-text-heading: var(--bw-white);
  --color-text-button: var(--bw-black); /* Black text on gray button */
  --color-text-link: var(--bw-white);
  --color-text-link-hover: var(--bw-light-gray);
  --color-text-placeholder: var(--bw-gray);
  --color-text-inverse: var(--bw-black); /* Text on selection */
  --color-text-accent: var(--bw-white);
  --color-text-error: var(--bw-white); /* White for errors */

  --color-border: var(--bw-gray);
  --color-border-accent: var(--bw-light-gray);
  --color-border-input: var(--bw-gray);
  --color-border-focus: var(--bw-white);

  --scrollbar-thumb-bg: var(--bw-gray);
  --scrollbar-track-bg: var(--bw-dark-gray);

  --border-standard: 1px solid var(--color-border);
  --border-accent: 1px solid var(--color-border-accent);
  --border-button: 1px solid var(--color-border);
  --border-radius-sm: 0;
  --border-radius-md: 0;
  --box-shadow-sm: none;
  --box-shadow-md: none;
  --button-bevel-shadow: none;

  --scanline-opacity: 0.1;
  --noise-opacity: 0.05; /* Add noise */
  --crt-filter: grayscale(100%) brightness(1.1) contrast(1.2);
}


/* --- Basic Reset & Global Styles --- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  font-family: var(--font-family-ui);
  font-size: var(--font-size-base);
  color: var(--color-text-primary);
  background-color: var(--color-bg-app);
}

html, body, #root {
  height: 100%;
  width: 100%;
  overflow: hidden;
}

/* Apply optional CRT Filter globally */
#root {
  position: relative; /* Needed for pseudo-elements */
  filter: var(--crt-filter);
  isolation: isolate; /* Create new stacking context for z-index */
}

/* Optional Scanline Overlay */
#root.theme-pipboy::after,
#root.theme-orange::after,
#root.theme-bw_tv::after {
  content: "";
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
  background-size: 100% 4px; /* Adjust thickness */
  pointer-events: none;
  z-index: 1000;
  opacity: var(--scanline-opacity);
}

/* Optional Noise Overlay for B&W TV */
@keyframes noiseAnimation {
  0% { transform: translate(0,0); }
  10% { transform: translate(-5%,-5%); }
  20% { transform: translate(-10%,5%); }
  30% { transform: translate(5%,-10%); }
  40% { transform: translate(-5%,15%); }
  50% { transform: translate(-10%,-5%); }
  60% { transform: translate(15%,0); }
  70% { transform: translate(0,10%); }
  80% { transform: translate(-15%,0); }
  90% { transform: translate(10%,5%); }
  100% { transform: translate(5%,0); }
}

#root.theme-bw_tv::before {
  content: "";
  position: absolute;
  top: -10%; left: -10%; /* Cover more area for animation */
  width: 120%;
  height: 120%;
  /* Generate noise texture: https://css-tricks.com/snippets/css/cross-browser-noise-texture/ */
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJub2lzZSI+PGZlVHVyYnVsZW5jZSB0eXBlPSJmcmFjdGFsTm9pc2UiIGJhc2VGcmVxdWVuY3k9IjAuOCIgbnVtT2N0YXZlcz0iMyIgc3RpdGNoVGlsZXM9InN0aXRjaCIvPjxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAtMC4xIDAuMSIvPjwvZmlsdGVyPjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWx0ZXI9InVybCgjbm9pc2UpIiBvcGFjaXR5PSIwLjUiLz48L3N2Zz4=");
  pointer-events: none;
  z-index: 1001; /* Above scanlines */
  opacity: var(--noise-opacity);
  animation: noiseAnimation .2s infinite;
}


/* Basic Scrollbar Styling */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}
::-webkit-scrollbar-track {
  background: var(--scrollbar-track-bg);
}
::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb-bg);
  border-radius: var(--border-radius-sm); /* Use theme radius */
}
::-webkit-scrollbar-thumb:hover {
  background: color-mix(in srgb, var(--scrollbar-thumb-bg) 80%, black);
}

/* --- Theme Specific Overrides for Components --- */

/* Win95 / mIRC Bevels */
.theme-win95 button, .theme-win95 .custom-select-trigger,
.theme-mirc button, .theme-mirc .custom-select-trigger {
  border: none; /* Remove default border */
  box-shadow: inset -1px -1px var(--win95-bevel-shadow-darker, transparent),
              inset 1px 1px var(--win95-bevel-shadow-light, transparent),
              inset -2px -2px var(--win95-bevel-shadow-dark, transparent),
              inset 2px 2px var(--win95-bevel-shadow-lighter, transparent);
  padding: calc(var(--spacing-xs) + 1px) calc(var(--spacing-sm) + 1px); /* Adjust padding for border */
}
.theme-win95 button:active, .theme-win95 .custom-select-trigger:active,
.theme-mirc button:active, .theme-mirc .custom-select-trigger:active {
   /* Inverted bevel for pressed state */
   box-shadow: inset 1px 1px var(--win95-bevel-shadow-darker, transparent),
               inset -1px -1px var(--win95-bevel-shadow-light, transparent),
               inset 2px 2px var(--win95-bevel-shadow-dark, transparent),
               inset -2px -2px var(--win95-bevel-shadow-lighter, transparent);
   padding: calc(var(--spacing-xs) + 2px) var(--spacing-sm) var(--spacing-xs) calc(var(--spacing-sm) + 2px); /* Shift text slightly */
}

/* Input field bevel */
.theme-win95 input[type="text"], .theme-win95 textarea, .theme-win95 .custom-select-options,
.theme-mirc input[type="text"], .theme-mirc textarea, .theme-mirc .custom-select-options {
  border: none;
   box-shadow: inset 1px 1px var(--win95-bevel-shadow-dark, transparent), /* Inset dark */
               inset -1px -1px var(--win95-bevel-shadow-light, transparent), /* Inset light */
               1px 1px 0 1px var(--win95-bevel-shadow-darker, transparent); /* Outer bottom/right black border */
   border-radius: 0;
}
.theme-win95 .custom-select-options,
.theme-mirc .custom-select-options {
     bottom: calc(100% + 1px); /* Adjust position slightly for bevel */
     box-shadow: inset 1px 1px var(--win95-bevel-shadow-dark, transparent),
                 inset -1px -1px var(--win95-bevel-shadow-light, transparent),
                 1px 1px 0 1px var(--win95-bevel-shadow-darker, transparent), /* Bottom/right */
                 -1px -1px 0 1px var(--win95-bevel-shadow-lighter, transparent); /* Top/left */
}


/* Win95/mIRC Scrollbars need more specific styling for bevels */
.theme-win95 ::-webkit-scrollbar-track,
.theme-mirc ::-webkit-scrollbar-track {
   background: #a0a0a0; /* Pattern or simple color */
   border: none;
}
.theme-win95 ::-webkit-scrollbar-thumb,
.theme-mirc ::-webkit-scrollbar-thumb {
    background-color: var(--color-bg-button);
    box-shadow: inset -1px -1px var(--win95-bevel-shadow-darker, transparent),
              inset 1px 1px var(--win95-bevel-shadow-light, transparent),
              inset -2px -2px var(--win95-bevel-shadow-dark, transparent),
              inset 2px 2px var(--win95-bevel-shadow-lighter, transparent);
    border: none;
    border-radius: 0;
}

/* Pip-Boy Specific Styles */
.theme-pipboy button, .theme-pipboy .custom-select-trigger {
  border: 1px solid var(--color-border);
  background: transparent;
  transition: background-color 0.1s ease-in-out;
}
.theme-pipboy button:hover, .theme-pipboy .custom-select-trigger:hover {
  background-color: var(--color-bg-button-hover);
}
.theme-pipboy button:active, .theme-pipboy .custom-select-trigger:active {
  background-color: var(--color-bg-button-active);
}
.theme-pipboy .custom-select-options {
    border: 1px solid var(--color-border);
    background-color: var(--pipboy-bg-lighter); /* Slightly different bg */
}
.theme-pipboy input, .theme-pipboy textarea {
   border: 1px solid var(--color-border);
   background-color: var(--color-bg-input);
   color: var(--color-text-primary);
}
.theme-pipboy ::-webkit-scrollbar-thumb {
    border: 1px solid var(--pipboy-green-darker);
}

/* Default Button / Input / Select styles for other themes */
button, .custom-select-trigger {
    background-color: var(--color-bg-button);
    border: var(--border-button);
    color: var(--color-text-button);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: background-color 0.15s ease, border-color 0.15s ease;
    font-size: inherit;
}
button:hover, .custom-select-trigger:hover {
    background-color: var(--color-bg-button-hover);
}
button:active, .custom-select-trigger:active {
    background-color: var(--color-bg-button-active);
}
input[type="text"], textarea {
    background-color: var(--color-bg-input);
    border: 1px solid var(--color-border-input);
    color: var(--color-text-primary);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--border-radius-sm);
    font-family: var(--font-family-mono);
    font-size: var(--font-size-sm);
}
input[type="text"]:focus, textarea:focus {
    outline: none;
    border-color: var(--color-border-focus);
    box-shadow: 0 0 0 1px var(--color-border-focus);
}
.custom-select-options {
    background-color: var(--color-bg-dropdown);
    border: 1px solid var(--color-border-input);
    border-radius: var(--border-radius-sm);
    box-shadow: var(--box-shadow-sm);
}
.custom-select-option:hover {
    background-color: var(--color-bg-hover);
}
.custom-select-option.selected {
    background-color: var(--color-bg-selected);
    color: var(--color-text-inverse);
}

/* --- END FILE: src/renderer/index.css --- */
--- END FILE: src/renderer/index.css ---

--- START FILE: src/renderer/components/TerminalPanel.tsx ---
// --- START FILE: src/renderer/components/TerminalPanel.tsx ---
import React, { useRef, useEffect, useState } from 'react'; // Import useState
import { Terminal, ITerminalOptions, ITheme } from 'xterm';
import { FitAddon } from 'xterm-addon-fit';
import 'xterm/css/xterm.css';
import { useTheme, ThemeName } from '../contexts/ThemeContext'; // Import ThemeName

const baseTerminalOptions: Omit<ITerminalOptions, 'theme'> = {
    cursorBlink: true,
    fontFamily: 'var(--font-family-mono)', // Use CSS var for consistency
    // fontSize is now handled dynamically in useEffect based on CSS var
    scrollback: 1000,
    convertEol: true, // Useful for Windows
};

// Define theme configurations for XTerm using hardcoded values from index.css
const terminalThemes: Record<ThemeName, ITheme> = { // Use ThemeName as key type
    light: { // Matches :root
        background: '#ffffff',
        foreground: '#333333',
        cursor: '#333333',
        selectionBackground: '#d5e5f6',
        selectionForeground: '#000000',
        black: '#000000',
        red: '#cd3131',
        green: '#0dbc79',
        yellow: '#e5e510',
        blue: '#2472c8',
        magenta: '#bc3fbc',
        cyan: '#11a8cd',
        white: '#e5e5e5',
        brightBlack: '#666666',
        brightRed: '#f14c4c',
        brightGreen: '#23d18b',
        brightYellow: '#f5f543',
        brightBlue: '#3b8eea',
        brightMagenta: '#d670d6',
        brightCyan: '#29b8db',
        brightWhite: '#e5e5e5',
    },
    dark: { // Matches .theme-dark
        background: '#1e1e1e',
        foreground: '#cccccc',
        cursor: '#cccccc',
        selectionBackground: '#094771',
        selectionForeground: '#ffffff',
        black: '#000000',
        red: '#cd3131',
        green: '#0dbc79',
        yellow: '#e5e510',
        blue: '#2472c8',
        magenta: '#bc3fbc',
        cyan: '#11a8cd',
        white: '#e5e5e5',
        brightBlack: '#666666',
        brightRed: '#f14c4c',
        brightGreen: '#23d18b',
        brightYellow: '#f5f543',
        brightBlue: '#3b8eea',
        brightMagenta: '#d670d6',
        brightCyan: '#29b8db',
        brightWhite: '#e5e5e5',
    },
    win95: { // Matches .theme-win95 terminal colors
        background: '#000080', // Blue background
        foreground: '#c0c0c0', // Light gray text
        cursor: '#c0c0c0',
        selectionBackground: '#c0c0c0', // Inverted selection
        selectionForeground: '#000080',
        // Basic ANSI
        black: '#000000', red: '#800000', green: '#008000', yellow: '#808000',
        blue: '#000080', magenta: '#800080', cyan: '#008080', white: '#c0c0c0',
        brightBlack: '#808080', brightRed: '#ff0000', brightGreen: '#00ff00', brightYellow: '#ffff00',
        brightBlue: '#0000ff', brightMagenta: '#ff00ff', brightCyan: '#00ffff', brightWhite: '#ffffff',
    },
    pipboy: { // Matches .theme-pipboy terminal colors
        background: '#0a1a0f', // --pipboy-bg
        foreground: '#15ff60', // --pipboy-green
        cursor: '#15ff60',
        cursorAccent: '#0a1a0f',
        selectionBackground: '#10b445', // --pipboy-green-dark
        selectionForeground: '#0a1a0f', // --pipboy-bg
        // Make ANSI colors shades of green
        black: '#050d07', red: '#0a702a', green: '#15ff60', yellow: '#10b445',
        blue: '#0a702a', magenta: '#10b445', cyan: '#15ff60', white: '#a0ffc0', // Lighter green
        brightBlack: '#0a702a', brightRed: '#10b445', brightGreen: '#a0ffc0', brightYellow: '#e0ffe0', // Very light
        brightBlue: '#10b445', brightMagenta: '#a0ffc0', brightCyan: '#e0ffe0', brightWhite: '#ffffff',
    },
    mirc: { // Matches .theme-mirc terminal colors
        background: '#000000', // Black background
        foreground: '#00ff00', // Green text
        cursor: '#00ff00',
        selectionBackground: '#008000', // Dark green selection
        selectionForeground: '#ffffff',
        // Similar to win95 but with green default fg
        black: '#000000', red: '#800000', green: '#008000', yellow: '#808000',
        blue: '#000080', magenta: '#800080', cyan: '#008080', white: '#c0c0c0',
        brightBlack: '#808080', brightRed: '#ff0000', brightGreen: '#00ff00', brightYellow: '#ffff00',
        brightBlue: '#0000ff', brightMagenta: '#ff00ff', brightCyan: '#00ffff', brightWhite: '#ffffff',
    },
    qbasic: { // Matches .theme-qbasic terminal colors
        background: '#0000AA', // Blue background
        foreground: '#FFFF55', // Yellow text
        cursor: '#FFFFFF', // White cursor
        selectionBackground: '#555555', // Dark gray selection
        selectionForeground: '#FFFFFF',
        // Basic ANSI, maybe adjusted?
        black: '#000000', red: '#AA0000', green: '#00AA00', yellow: '#AA5500',
        blue: '#0000AA', magenta: '#AA00AA', cyan: '#00AAAA', white: '#AAAAAA',
        brightBlack: '#555555', brightRed: '#FF5555', brightGreen: '#55FF55', brightYellow: '#FFFF55',
        brightBlue: '#5555FF', brightMagenta: '#FF55FF', brightCyan: '#55FFFF', brightWhite: '#FFFFFF',
    },
    orange: { // Matches .theme-orange terminal colors
        background: '#201500', // Dark background
        foreground: '#FFA500', // Bright Orange text
        cursor: '#FFA500',
        cursorAccent: '#201500',
        selectionBackground: '#D98C00', // Medium orange selection
        selectionForeground: '#201500',
        // Make ANSI colors shades of orange/brown
        black: '#100A00', red: '#D98C00', green: '#FFA500', yellow: '#FFC04D', // Lighter orange
        blue: '#D98C00', magenta: '#FFA500', cyan: '#FFC04D', white: '#FFE0B3', // Pale orange
        brightBlack: '#5A3D00', brightRed: '#FFC04D', brightGreen: '#FFE0B3', brightYellow: '#FFF5E0', // Very pale
        brightBlue: '#FFC04D', brightMagenta: '#FFE0B3', brightCyan: '#FFF5E0', brightWhite: '#FFFFFF',
    },
    cga: { // Matches .theme-cga terminal colors
        background: '#000000', // Black background
        foreground: '#55FFFF', // Cyan text
        cursor: '#FFFFFF', // White cursor
        selectionBackground: '#55FFFF', // Cyan selection
        selectionForeground: '#000000', // Black text on selection
        // CGA Palette 1 (High Intensity)
        black: '#000000', red: '#FF5555', green: '#55FF55', yellow: '#FFFF55',
        blue: '#5555FF', magenta: '#FF55FF', cyan: '#55FFFF', white: '#FFFFFF',
        brightBlack: '#555555', brightRed: '#FF5555', brightGreen: '#55FF55', brightYellow: '#FFFF55',
        brightBlue: '#5555FF', brightMagenta: '#FF55FF', brightCyan: '#55FFFF', brightWhite: '#FFFFFF',
    },
    atari: { // Matches .theme-atari terminal colors
        background: '#000000', // Black background
        foreground: '#3FFFCF', // Cyan text
        cursor: '#D87050', // Orange cursor
        selectionBackground: '#D87050', // Orange selection
        selectionForeground: '#000000',
        // Atari-like colors
        black: '#000000', red: '#D87050', green: '#3FFFCF', yellow: '#D8D850',
        blue: '#5070D8', magenta: '#D870D8', cyan: '#3FFFCF', white: '#AAAAAA',
        brightBlack: '#444444', brightRed: '#F0A080', brightGreen: '#7FFFEF', brightYellow: '#F0F080',
        brightBlue: '#80A0F0', brightMagenta: '#F0A0F0', brightCyan: '#7FFFEF', brightWhite: '#FFFFFF',
    },
    snes: { // Matches .theme-snes terminal colors
        background: '#2F2F4F', // Dark purplish gray bg
        foreground: '#E0E0FF', // Light lavender text
        cursor: '#E0E040', // Yellow cursor
        selectionBackground: '#8080FF', // Purple selection
        selectionForeground: '#2F2F4F',
        // SNES-like accents
        black: '#101020', red: '#E04040', green: '#40C040', yellow: '#E0E040',
        blue: '#8080FF', magenta: '#C080FF', cyan: '#80C0FF', white: '#E0E0FF',
        brightBlack: '#505070', brightRed: '#FF7070', brightGreen: '#70F070', brightYellow: '#F0F070',
        brightBlue: '#B0B0FF', brightMagenta: '#F0B0FF', brightCyan: '#B0F0FF', brightWhite: '#FFFFFF',
    },
    bw_tv: { // Matches .theme-bw_tv terminal colors
        background: '#000000', // Black background
        foreground: '#cccccc', // Light gray text
        cursor: '#ffffff', // White cursor
        selectionBackground: '#cccccc', // Light gray selection
        selectionForeground: '#000000', // Black text on selection
        // Greyscale ANSI
        black: '#000000', red: '#888888', green: '#aaaaaa', yellow: '#bbbbbb',
        blue: '#888888', magenta: '#aaaaaa', cyan: '#bbbbbb', white: '#cccccc',
        brightBlack: '#555555', brightRed: '#aaaaaa', brightGreen: '#cccccc', brightYellow: '#dddddd',
        brightBlue: '#aaaaaa', brightMagenta: '#cccccc', brightCyan: '#dddddd', brightWhite: '#ffffff',
    }
};

const TerminalPanel: React.FC = () => {
    const { theme } = useTheme(); // theme object from context includes theme name and font size modifier
    const terminalContainerRef = useRef<HTMLDivElement | null>(null);
    const terminalInstanceRef = useRef<Terminal | null>(null);
    const fitAddonRef = useRef<FitAddon | null>(null); // Hold FitAddon instance
    const effect2Cleanupables = useRef<Array<() => void>>([]);
    const [isPtyCreated, setIsPtyCreated] = useState(false); // Track PTY creation

    // Helper function to get terminal font size from CSS variable
    const getTerminalFontSize = (): number => {
        // Use the --font-size-terminal CSS variable which is updated by ThemeContext
        const fontSizeValue = getComputedStyle(document.documentElement).getPropertyValue('--font-size-terminal');
        return parseInt(fontSizeValue?.replace('px', '').trim() || '13', 10); // Default to 13px
    };


    // Effect 1: Create Terminal Instance (NO PTY CREATION HERE)
    useEffect(() => {
        let isMounted = true;
        if (terminalInstanceRef.current === null && terminalContainerRef.current) {
            console.log("Effect 1: Creating Frontend Terminal instance.");
            const container = terminalContainerRef.current;
            container.innerHTML = ''; // Clear previous instance if any lingered

            // Theme/Fontsize are set initially in Effect 3 now
            const initialTermOptions: ITerminalOptions = {
                ...baseTerminalOptions,
                // Set placeholder theme/size, will be overwritten by Effect 3
                theme: terminalThemes.dark,
                fontSize: 13,
            };

            const term = new Terminal(initialTermOptions);
            terminalInstanceRef.current = term;

            // Create and store FitAddon instance
            fitAddonRef.current = new FitAddon();
            term.loadAddon(fitAddonRef.current);

            term.open(container);
            console.log("Effect 1: Frontend Terminal instance created and attached.");
            // NOTE: No fit or term_create here anymore
        }

        return () => {
            isMounted = false; // Mark as unmounted
            console.log("Effect 1 Cleanup: Disposing frontend terminal instance.");
            // Dispose addon first
            try { fitAddonRef.current?.dispose(); fitAddonRef.current = null; } catch(e) {/* ignore */}
            // Dispose terminal
            terminalInstanceRef.current?.dispose();
            terminalInstanceRef.current = null;
            setIsPtyCreated(false); // Reset PTY status on unmount
        };
    // Only run on mount
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    // Effect 2: Setup IPC Listeners, Input Forwarding, and Resizing
    useEffect(() => {
        const term = terminalInstanceRef.current;
        const container = terminalContainerRef.current;
        let isEffect2Mounted = true; // Scope mount status to this effect

        if (term && container) {
            console.log("Effect 2: Setting up IPC listeners, input forwarding, and resize observer...");
            // Clear previous listeners from this effect
            effect2Cleanupables.current.forEach(cleanup => cleanup());
            effect2Cleanupables.current = [];

            const unsubscribeOnData = window.electronAPI.term_onData((data) => {
                if(isEffect2Mounted && terminalInstanceRef.current) terminalInstanceRef.current.write(data)
            });
            effect2Cleanupables.current.push(unsubscribeOnData);

            const unsubscribeOnExit = window.electronAPI.term_onExit((code) => {
                 if(isEffect2Mounted && terminalInstanceRef.current) {
                    terminalInstanceRef.current.writeln(`\n\n[Process exited with code ${code ?? 'N/A'}]`);
                    setIsPtyCreated(false); // Allow recreation if process exits
                 }
             });
            effect2Cleanupables.current.push(unsubscribeOnExit);

            const unsubscribeOnError = window.electronAPI.term_onError((errorMessage) => {
                 if(isEffect2Mounted && terminalInstanceRef.current) {
                    terminalInstanceRef.current.writeln(`\n\n[PTY Error: ${errorMessage}]`);
                 }
             });
            effect2Cleanupables.current.push(unsubscribeOnError);

            const dataListener = term.onData((data: string) => {
                // Only send if still mounted conceptually
                if (isEffect2Mounted) window.electronAPI.term_write(data)
            });

            // Resize Observer
            let resizeTimeout: NodeJS.Timeout | null = null;
            const resizeObserver = new ResizeObserver(() => {
                // Debounce resize event
                if (resizeTimeout) clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    // Check refs inside the debounced function
                    if (!isEffect2Mounted || !terminalInstanceRef.current || !fitAddonRef.current) return;
                    try {
                        console.log("ResizeObserver: Fitting terminal"); // Add log
                        fitAddonRef.current.fit();
                        // Send resize only if PTY exists
                        if (isPtyCreated) {
                           console.log(`ResizeObserver: Sending dimensions ${terminalInstanceRef.current.cols}x${terminalInstanceRef.current.rows}`); // Add log
                           window.electronAPI.term_resize({ cols: terminalInstanceRef.current.cols, rows: terminalInstanceRef.current.rows });
                        }
                    } catch (e) { console.error("Resize handling error:", e); }
                }, 150); // Increased debounce slightly
            });
            resizeObserver.observe(container);
            effect2Cleanupables.current.push(() => {
                if (resizeTimeout) clearTimeout(resizeTimeout);
                resizeObserver.disconnect();
            });

            return () => {
                isEffect2Mounted = false; // Mark as unmounted for this effect's scope
                console.log('Effect 2 Cleanup: Cleaning up IPC listeners and observer...');
                effect2Cleanupables.current.forEach(cleanup => cleanup());
                effect2Cleanupables.current = [];
                try { dataListener?.dispose(); } catch (e) { /* ignore */ }
            };
        } else {
             console.log("Effect 2: Waiting for terminal instance and container...");
        }
    // Re-run if terminal instance ref *itself* changes OR isPtyCreated changes
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [terminalInstanceRef.current, isPtyCreated]);

    // Effect 3: Handle Theme/Font Changes & INITIAL PTY CREATION
    useEffect(() => {
        const term = terminalInstanceRef.current;
        const addon = fitAddonRef.current;

        if (term && addon) {
            const currentThemeName = theme; // Extract theme name from context object
            const currentTerminalTheme = terminalThemes[currentThemeName] || terminalThemes['dark'];
            const currentFontSize = getTerminalFontSize(); // Get font size based on CSS var
            let fontChanged = false;

            // Update theme if needed
            if (term.options.theme !== currentTerminalTheme) {
                console.log(`Effect 3: Updating terminal theme to ${currentThemeName}`);
                term.options.theme = currentTerminalTheme;
            }

            // Update font size if needed
            if (term.options.fontSize !== currentFontSize) {
                console.log(`Effect 3: Updating terminal font size to ${currentFontSize}px`);
                term.options.fontSize = currentFontSize;
                fontChanged = true; // Mark that font size changed
            }

            // Perform fit & PTY creation *only* on the first run after mount OR if font size changed
            const performFitAndCreate = () => {
                try {
                    console.log("Effect 3: Fitting terminal...");
                    addon.fit();
                    const initialCols = term.cols;
                    const initialRows = term.rows;
                    console.log(`Effect 3: Fit complete. Dimensions: ${initialCols}x${initialRows}`);

                    // --- Create PTY only if not already created ---
                    if (!isPtyCreated && initialCols > 0 && initialRows > 0) {
                        console.log("Effect 3: Requesting backend PTY creation...");
                        term.writeln("Connecting to backend shell..."); // Give feedback
                        window.electronAPI.term_create({ cols: initialCols, rows: initialRows })
                            .then((result) => {
                                // Check if component is still mounted and PTY wasn't created concurrently
                                if (terminalInstanceRef.current && !isPtyCreated) {
                                    if (result?.success) {
                                        console.log("Effect 3: Backend PTY creation request successful.");
                                        setIsPtyCreated(true); // Mark as created
                                        terminalInstanceRef.current?.focus();
                                    } else {
                                        console.error("Effect 3: Backend PTY creation request failed:", result?.error);
                                        terminalInstanceRef.current?.writeln(`\nFailed to create backend shell: ${result?.error || 'Unknown error'}`);
                                    }
                                }
                            })
                            .catch(err => {
                                if (terminalInstanceRef.current) { // Check ref exists
                                     console.error("Effect 3: IPC Backend PTY creation request failed:", err);
                                     terminalInstanceRef.current?.writeln(`\nIPC Error creating backend shell: ${err.message || err}`);
                                }
                            });
                    } else if (isPtyCreated) {
                        // If PTY already exists and font changed, just resize
                        console.log(`Effect 3: PTY exists, sending resize ${initialCols}x${initialRows}`);
                        window.electronAPI.term_resize({ cols: initialCols, rows: initialRows });
                    } else if (initialCols <= 0 || initialRows <= 0) {
                         console.warn(`Effect 3: Skipping PTY creation due to invalid dimensions: ${initialCols}x${initialRows}`);
                         // Maybe schedule a retry after a short delay?
                         // setTimeout(performFitAndCreate, 300); // Example retry
                    }

                } catch (e) {
                    console.warn("Effect 3: Fit or PTY creation/resize failed:", e);
                }
            };

            // If font changed, always refit/resize.
            // If it's the initial run (isPtyCreated is false), also fit/create.
            if (fontChanged || !isPtyCreated) {
                 // Use RAF to ensure DOM updates are applied before fit
                 requestAnimationFrame(performFitAndCreate);
            }
        }
    // Dependency includes the theme object and isPtyCreated state
    }, [theme, isPtyCreated]);


    return (
        // Ensure the container takes full space of its parent (.terminal-panel)
        <div className="terminal-panel-container" ref={terminalContainerRef} style={{ width: '100%', height: '100%' }}></div>
    );
};

export default TerminalPanel;
// --- END FILE: src/renderer/components/TerminalPanel.tsx ---
--- END FILE: src/renderer/components/TerminalPanel.tsx ---

--- START FILE: src/renderer/components/Sidebar.tsx ---
// --- START FILE: src/renderer/components/Sidebar.tsx ---
// src/renderer/components/Sidebar.tsx
import React from 'react';
import { useTheme, ThemeName } from '../contexts/ThemeContext';
import CustomSelect from './CustomSelect'; // Import the custom component

// Define the options for the custom select - ADD NEW THEMES HERE
const themeOptions: { value: ThemeName; label: string }[] = [
  { value: 'light', label: 'Light' },
  { value: 'dark', label: 'Dark (VS Code)' },
  { value: 'win95', label: 'Windows 95' },
  { value: 'pipboy', label: 'Pip-Boy' },
  { value: 'mirc', label: 'mIRC' },
  { value: 'qbasic', label: 'QBasic' },
  { value: 'orange', label: 'Orange CRT' },
  { value: 'cga', label: 'CGA (Cyan)' },
  { value: 'atari', label: 'Atari 2600' },
  { value: 'snes', label: 'SNES' },
  { value: 'bw_tv', label: 'B&W TV' },
];

const Sidebar: React.FC = () => {
  const { theme, setTheme } = useTheme();

  return (
    <div className="sidebar">
      <h2>Files</h2>

      {/* File tree placeholder */}
      <div className="file-tree-placeholder">
        <p>Placeholder for file tree...</p>
        <p>Next step: Implement file browsing!</p>
      </div>

      {/* Theme Switcher Section - At the bottom */}
      <div className="theme-switcher">
        <label id="theme-select-label" htmlFor="theme-select">
          Theme:
        </label>
        {/* Use CustomSelect */}
        <CustomSelect<ThemeName>
          labelId="theme-select-label"
          options={themeOptions} // Use updated options
          value={theme}
          onChange={(newTheme) => setTheme(newTheme)}
        />
      </div>
    </div>
  );
};

export default Sidebar;
// --- END FILE: src/renderer/components/Sidebar.tsx ---
--- END FILE: src/renderer/components/Sidebar.tsx ---

--- START FILE: src/renderer/components/MainPanel.tsx ---
// --- START FILE: src/renderer/components/MainPanel.tsx ---
import React from 'react';
import { Allotment } from 'allotment';
import EditorPanel from './EditorPanel';
import TerminalPanel from './TerminalPanel';
import { useTheme } from '../contexts/ThemeContext'; // Import useTheme

const MainPanel: React.FC = () => {
  // Get access to font size settings if needed by Allotment itself (unlikely needed for now)
  // const { fontSizeModifier } = useTheme();

  // Retrieve terminal height from CSS variable to set initial size hint
  // Note: This is just a HINT. Allotment manages the actual size.
  const getTerminalInitialSize = () => {
    const heightValue = getComputedStyle(document.documentElement)
                          .getPropertyValue('--terminal-height')?.trim() || '200px';
    return parseInt(heightValue.replace('px', ''), 10) || 200;
  };

  return (
    <div className="main-panel"> {/* Container with flex-grow: 1, flex-direction: column */}
      {/*
        Allotment handles the resizable split.
        The 'vertical' prop means the separator moves up/down.
        The sizes array provides initial proportional distribution or fixed sizes.
        Giving the terminal pane a fixed initial size based on CSS var.
      */}
      <Allotment vertical>
        <Allotment.Pane>
          {/* Editor takes up the remaining space initially */}
          <EditorPanel />
        </Allotment.Pane>
        <Allotment.Pane
          preferredSize={getTerminalInitialSize()} // Use CSS variable for initial size
          minSize={50} // Prevent terminal from becoming too small
          maxSize={600} // Optional: Limit terminal max height
          snap // Enable snapping when near the edges or minimum/maximum size
        >
          <TerminalPanel />
        </Allotment.Pane>
      </Allotment>
    </div>
  );
};

export default MainPanel;
// --- END FILE: src/renderer/components/MainPanel.tsx ---
--- END FILE: src/renderer/components/MainPanel.tsx ---

--- START FILE: src/renderer/components/EditorPanel.tsx ---
// --- START FILE: src/renderer/components/EditorPanel.tsx ---
// src/renderer/components/EditorPanel.tsx
import React, { useState, useEffect, useRef } from 'react';
import MonacoEditor from 'react-monaco-editor';
import type * as monaco from 'monaco-editor/esm/vs/editor/editor.api';

import { useTheme, ThemeName } from '../contexts/ThemeContext';

// Helper function to safely get and parse font size from CSS variable
const getEditorFontSize = (): number => {
    // Ensure document exists before accessing computed style
    if (typeof document === 'undefined') return 13; // Default if SSR or other env
    const fontSizeValue = getComputedStyle(document.documentElement).getPropertyValue('--font-size-editor');
    return parseInt(fontSizeValue?.replace('px', '').trim() || '13', 10);
};

// Helper to get computed CSS variable value
const getCssVar = (varName: string, fallback: string): string => {
    // Ensure we're in a browser environment before accessing document
    if (typeof document !== 'undefined') {
        return getComputedStyle(document.documentElement).getPropertyValue(varName)?.trim() || fallback;
    }
    return fallback; // Return fallback if not in browser
};


const EditorPanel: React.FC = () => {
    const { theme } = useTheme(); // Get the whole theme object
    const [code, setCode] = useState<string>(
        '// Welcome to CodeCraft IDE!\n' +
        '// Use the dropdown in the sidebar to change themes.\n' +
        'function hello() {\n' +
        '\tconsole.log("Hello from Monaco Editor!");\n' +
        '}'
    );
    const editorRef = useRef<monaco.editor.IStandaloneCodeEditor | null>(null);
    const monacoRef = useRef<typeof monaco | null>(null);

    // Map app theme names to Monaco theme names
    const getMonacoThemeName = (currentTheme: ThemeName): string => {
        switch (currentTheme) {
            case 'light': return 'vs';
            case 'dark': return 'vs-dark';
            case 'win95': return 'win95-monaco-theme';
            case 'pipboy': return 'pipboy-monaco-theme';
            case 'mirc': return 'mirc-monaco-theme';
            case 'qbasic': return 'qbasic-monaco-theme';
            case 'orange': return 'orange-monaco-theme';
            case 'cga': return 'cga-monaco-theme';
            case 'atari': return 'atari-monaco-theme';
            case 'snes': return 'snes-monaco-theme';
            case 'bw_tv': return 'bw-tv-monaco-theme';
            default: return 'vs-dark'; // Fallback
        }
    };

    // --- Updated Editor Options ---
    const editorOptions: monaco.editor.IStandaloneEditorConstructionOptions = {
        selectOnLineNumbers: true,
        automaticLayout: true, // Essential for resizing
        fontFamily: 'var(--font-family-mono)',
        fontSize: getEditorFontSize(), // Get initial size correctly
        minimap: { enabled: true }, // *** RE-ENABLE MINIMAP HERE ***
        wordWrap: 'on', // Example: enable word wrap
        scrollBeyondLastLine: false,
        // theme: getMonacoThemeName(theme.theme) // Set initial theme via editorDidMount
    };

    const handleEditorChange = (newValue: string) => {
        setCode(newValue);
        // Later: Add logic to track unsaved changes
    };

    const editorDidMount = (
        editor: monaco.editor.IStandaloneCodeEditor,
        monacoInstance: typeof monaco
    ) => {
        console.log('Editor mounted!');
        editorRef.current = editor;
        monacoRef.current = monacoInstance;

        // Helper to define Monaco themes using CSS variables
        const defineTheme = (name: string, base: 'vs' | 'vs-dark', cssVarPrefix: string, colorsOverride?: monaco.editor.IStandaloneThemeData['colors']) => {
            // No need to check if theme exists, defineTheme handles redefinition or use try/catch
            try {
                monacoInstance.editor.defineTheme(name, {
                    base: base,
                    inherit: true,
                    rules: [], // Keep rules empty for simplicity, inherit from base
                    colors: {
                        'editor.background': getCssVar(`--${cssVarPrefix}-bg`, base === 'vs' ? '#ffffff' : '#1e1e1e'),
                        'editor.foreground': getCssVar(`--${cssVarPrefix}-text`, base === 'vs' ? '#000000' : '#d4d4d4'),
                        'editorCursor.foreground': getCssVar(`--${cssVarPrefix}-accent`, base === 'vs' ? '#000000' : '#aeafad'),
                        'editorLineNumber.foreground': getCssVar(`--${cssVarPrefix}-tertiary`, '#858585'),
                        'editorLineNumber.activeForeground': getCssVar(`--${cssVarPrefix}-secondary`, '#c6c6c6'),
                        'editor.selectionBackground': getCssVar(`--${cssVarPrefix}-selected-bg`, '#add6ff'),
                        'editor.selectionForeground': getCssVar(`--${cssVarPrefix}-selected-text`, '#000000'),
                        'editorWidget.background': getCssVar(`--${cssVarPrefix}-widget-bg`, base === 'vs' ? '#f3f3f3' : '#252526'),
                        'editorWidget.border': getCssVar(`--${cssVarPrefix}-border`, '#c8c8c8'),
                        'input.background': getCssVar(`--${cssVarPrefix}-input-bg`, base === 'vs' ? '#ffffff' : '#3c3c3c'),
                        'input.foreground': getCssVar(`--${cssVarPrefix}-input-text`, base === 'vs' ? '#000000' : '#d4d4d4'),
                        'input.border': getCssVar(`--${cssVarPrefix}-input-border`, '#bebebe'),
                        ...colorsOverride // Allow specific overrides
                    }
                });
                console.log(`Defined Monaco theme: ${name}`);
            } catch (error) {
                console.error(`Failed to define Monaco theme '${name}':`, error);
            }
        };

        // --- Define Custom Monaco Themes ---
        defineTheme('pipboy-monaco-theme', 'vs-dark', 'pipboy', {
            'editor.background': getCssVar('--pipboy-bg', '#0a1a0f'),
            'editor.foreground': getCssVar('--pipboy-green', '#15ff60'),
            'editorCursor.foreground': getCssVar('--pipboy-green', '#15ff60'),
            'editor.selectionBackground': getCssVar('--pipboy-green-dark', '#10b445'),
            'editor.selectionForeground': getCssVar('--pipboy-bg', '#0a1a0f'),
            'editorWidget.background': getCssVar('--pipboy-bg-lighter', '#102a18'),
            'editorWidget.border': getCssVar('--pipboy-green-dark', '#10b445'),
        });
        defineTheme('win95-monaco-theme', 'vs', 'win95', {
            'editor.background': getCssVar('--color-bg-editor', '#ffffff'),
            'editor.foreground': getCssVar('--color-text-primary', '#000000'),
            'editorCursor.foreground': '#000000',
            'editor.selectionBackground': getCssVar('--color-bg-selected', '#000080'),
            'editor.selectionForeground': getCssVar('--color-text-inverse', '#ffffff'),
        });
        defineTheme('mirc-monaco-theme', 'vs', 'mirc', {
            'editor.background': getCssVar('--color-bg-editor', '#ffffff'),
            'editor.foreground': getCssVar('--color-text-primary', '#000000'),
            'editorCursor.foreground': '#000000',
            'editor.selectionBackground': getCssVar('--color-bg-selected', '#000080'),
            'editor.selectionForeground': getCssVar('--color-text-inverse', '#ffffff'),
        });
        defineTheme('qbasic-monaco-theme', 'vs-dark', 'qbasic', {
             'editor.background': getCssVar('--qbasic-blue', '#0000AA'),
             'editor.foreground': getCssVar('--qbasic-yellow', '#FFFF55'),
             'editorCursor.foreground': getCssVar('--qbasic-white', '#FFFFFF'),
             'editor.selectionBackground': getCssVar('--qbasic-dark-gray', '#555555'),
             'editor.selectionForeground': getCssVar('--qbasic-white', '#FFFFFF'),
        });
        defineTheme('orange-monaco-theme', 'vs-dark', 'orange', {
             'editor.background': getCssVar('--orange-dark', '#201500'),
             'editor.foreground': getCssVar('--orange-bright', '#FFA500'),
             'editorCursor.foreground': getCssVar('--orange-bright', '#FFA500'),
             'editor.selectionBackground': getCssVar('--orange-medium', '#D98C00'),
             'editor.selectionForeground': getCssVar('--orange-dark', '#201500'),
        });
         defineTheme('cga-monaco-theme', 'vs-dark', 'cga', {
             'editor.background': getCssVar('--cga-black', '#000000'),
             'editor.foreground': getCssVar('--cga-cyan', '#55FFFF'),
             'editorCursor.foreground': getCssVar('--cga-white', '#FFFFFF'),
             'editor.selectionBackground': getCssVar('--cga-cyan', '#55FFFF'),
             'editor.selectionForeground': getCssVar('--cga-black', '#000000'),
         });
         defineTheme('atari-monaco-theme', 'vs-dark', 'atari', {
             'editor.background': getCssVar('--atari-black', '#000000'),
             'editor.foreground': getCssVar('--atari-cyan', '#3FFFCF'),
             'editorCursor.foreground': getCssVar('--atari-orange', '#D87050'),
             'editor.selectionBackground': getCssVar('--atari-orange', '#D87050'),
             'editor.selectionForeground': getCssVar('--atari-black', '#000000'),
         });
         defineTheme('snes-monaco-theme', 'vs-dark', 'snes', {
             'editor.background': getCssVar('--snes-bg', '#2F2F4F'),
             'editor.foreground': getCssVar('--snes-text', '#E0E0FF'),
             'editorCursor.foreground': getCssVar('--snes-accent4', '#E0E040'), // Yellow cursor
             'editor.selectionBackground': getCssVar('--snes-accent1', '#8080FF'),
             'editor.selectionForeground': getCssVar('--snes-bg', '#2F2F4F'),
         });
         defineTheme('bw-tv-monaco-theme', 'vs-dark', 'bw-tv', {
             'editor.background': getCssVar('--bw-black', '#000000'),
             'editor.foreground': getCssVar('--bw-light-gray', '#cccccc'),
             'editorCursor.foreground': getCssVar('--bw-white', '#ffffff'),
             'editor.selectionBackground': getCssVar('--bw-light-gray', '#cccccc'),
             'editor.selectionForeground': getCssVar('--bw-black', '#000000'),
         });

        // Apply the initial theme after defining custom ones
        const initialThemeName = getMonacoThemeName(theme);
        monacoInstance.editor.setTheme(initialThemeName);
        console.log("Initial Monaco theme set to:", initialThemeName);

        // Apply initial font size and scroll option
         editor.updateOptions({
             fontSize: getEditorFontSize(),
             scrollBeyondLastLine: false
         });

        editor.focus();
    };

    // Effect to update theme and font size when context changes
    useEffect(() => {
        if (editorRef.current && monacoRef.current) {
            const editor = editorRef.current;
            const monacoInstance = monacoRef.current;

            // Update theme
            const newThemeName = getMonacoThemeName(theme);
            monacoInstance.editor.setTheme(newThemeName);

            // Update font size and scrollBeyondLastLine
            const newFontSize = getEditorFontSize();
            editor.updateOptions({
                fontSize: newFontSize,
                scrollBeyondLastLine: false // Re-apply on theme change too
            });
        }
    // Update when the theme object (including name and font size modifier) changes
    }, [theme]);


    return (
        <div className="editor-panel">
            <MonacoEditor
                width="100%"
                height="100%"
                language="javascript" // Default language, can be changed later
                value={code}
                options={editorOptions} // Pass initial options including minimap: true
                onChange={handleEditorChange}
                editorDidMount={editorDidMount}
            />
        </div>
    );
};

export default EditorPanel;
// --- END FILE: src/renderer/components/EditorPanel.tsx ---
--- END FILE: src/renderer/components/EditorPanel.tsx ---

--- START FILE: src/renderer/components/CustomSelect.css ---
/* src/renderer/components/CustomSelect.css */

.custom-select-container {
    position: relative; /* Anchor for the absolute positioned options */
    width: 100%;
    font-family: var(--font-family-ui);
  }
  
  .custom-select-trigger {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: var(--spacing-xs) var(--spacing-sm);
    background-color: var(--color-bg-input);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border-input);
    border-radius: var(--border-radius-sm);
    font-size: var(--font-size-sm);
    cursor: pointer;
    text-align: left;
    appearance: none; /* Remove default button styles */
  }
  
  .custom-select-trigger:focus {
    outline: none;
    border-color: var(--color-border-focus);
    box-shadow: 0 0 0 1px var(--color-border-focus);
  }
  
  .custom-select-arrow {
    margin-left: var(--spacing-sm);
    color: var(--color-text-secondary);
  }
  
  .custom-select-options {
    position: absolute;
    /* Position it above the trigger */
    bottom: calc(100% + var(--spacing-xxs)); /* Place it just above, with a small gap */
    left: 0;
    right: 0; /* Make it full width */
    background-color: var(--color-bg-dropdown);
    border: 1px solid var(--color-border-input);
    border-radius: var(--border-radius-sm);
    list-style: none;
    padding: var(--spacing-xs) 0;
    margin: 0;
    max-height: 150px; /* Limit height and allow scrolling */
    overflow-y: auto;
    z-index: 10; /* Ensure it appears above other elements */
    box-shadow: var(--box-shadow-sm);
  }
  
  .custom-select-option {
    padding: var(--spacing-xs) var(--spacing-sm);
    cursor: pointer;
    color: var(--color-text-primary);
    font-size: var(--font-size-sm);
  }
  
  .custom-select-option:hover {
    background-color: var(--color-bg-hover);
  }
  
  .custom-select-option.selected {
    background-color: var(--color-bg-selected);
    color: var(--color-text-inverse); /* Adjust if needed based on selection bg */
    font-weight: bold; /* Or other indicator */
  }
  
  /* Optional: Style scrollbar inside options */
  .custom-select-options::-webkit-scrollbar {
    width: 8px;
  }
  .custom-select-options::-webkit-scrollbar-track {
    background: var(--scrollbar-track-bg);
    border-radius: 4px;
  }
  .custom-select-options::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb-bg);
    border-radius: 4px;
  }
  .custom-select-options::-webkit-scrollbar-thumb:hover {
    background: color-mix(in srgb, var(--scrollbar-thumb-bg) 80%, black);
  }
--- END FILE: src/renderer/components/CustomSelect.css ---

--- START FILE: src/renderer/components/CustomSelect.tsx ---
// src/renderer/components/CustomSelect.tsx
import React, { useState, useRef, useEffect, ReactNode } from 'react';
import './CustomSelect.css'; // We'll create this CSS file next

interface CustomSelectOption<T extends string> {
  value: T;
  label: ReactNode; // Allow JSX for labels if needed
}

interface CustomSelectProps<T extends string> {
  options: CustomSelectOption<T>[];
  value: T;
  onChange: (value: T) => void;
  labelId?: string; // For accessibility
}

function CustomSelect<T extends string>({
  options,
  value,
  onChange,
  labelId,
}: CustomSelectProps<T>) {
  const [isOpen, setIsOpen] = useState(false);
  const selectRef = useRef<HTMLDivElement>(null);
  const selectedOption = options.find(option => option.value === value);

  // Close dropdown if clicked outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (selectRef.current && !selectRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    };
    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    } else {
      document.removeEventListener('mousedown', handleClickOutside);
    }
    // Cleanup listener on unmount or when isOpen changes
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen]);

  const handleOptionClick = (optionValue: T) => {
    onChange(optionValue);
    setIsOpen(false);
  };

  const toggleOpen = () => {
    setIsOpen(!isOpen);
  };

  return (
    <div className="custom-select-container" ref={selectRef}>
      <button
        type="button"
        className="custom-select-trigger"
        onClick={toggleOpen}
        aria-haspopup="listbox"
        aria-expanded={isOpen}
        aria-labelledby={labelId} // Link to external label if provided
      >
        {selectedOption?.label || 'Select...'}
        <span className="custom-select-arrow">{isOpen ? '' : ''}</span>
      </button>
      {isOpen && (
        <ul
          className="custom-select-options"
          role="listbox"
          aria-activedescendant={value} // Indicate current selection
          aria-labelledby={labelId}
        >
          {options.map(option => (
            <li
              key={option.value}
              className={`custom-select-option ${option.value === value ? 'selected' : ''}`}
              onClick={() => handleOptionClick(option.value)}
              role="option"
              aria-selected={option.value === value}
              id={option.value} // Used for aria-activedescendant
            >
              {option.label}
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}

export default CustomSelect;
--- END FILE: src/renderer/components/CustomSelect.tsx ---

--- START FILE: src/renderer/App.css ---
/* src/renderer/App.css */

.app-container {
    display: flex;
    height: 100%;
    width: 100%;
    background-color: var(--color-bg-app);
  }
  
  .sidebar {
    width: var(--sidebar-width); /* Use variable */
    flex-shrink: 0;
    background-color: var(--color-bg-sidebar);
    border-right: var(--border-standard); /* Use variable */
    padding: var(--spacing-md);
    height: 100%;
    /* IMPORTANT: Remove overflow-y: auto; from the sidebar itself */
    /* overflow-y: auto; */
    overflow: hidden; /* Hide overflow instead */
    color: var(--color-text-primary);
    display: flex;
    flex-direction: column; /* Stack elements vertically */
  }
  
  .sidebar h2 {
    margin-bottom: var(--spacing-sm);
    font-size: var(--font-size-lg);
    color: var(--color-text-heading);
    flex-shrink: 0; /* Prevent shrinking */
  }
  
  /* Container for the file tree (or its placeholder) */
  .sidebar .file-tree-placeholder {
      color: var(--color-text-secondary);
      font-size: var(--font-size-sm);
      flex-grow: 1; /* Allow placeholder to take remaining vertical space */
      overflow-y: auto; /* Allow scrolling WITHIN this area if content grows */
      min-height: 50px; /* Give it some minimum space so it doesn't disappear */
      /* Optional: Add some padding if needed inside this area */
      /* padding: var(--spacing-sm) 0; */
      margin-bottom: var(--spacing-md); /* Add space between file tree and switcher */
  }
  
  
  /* Theme switcher container - Positioned at the bottom */
  .sidebar .theme-switcher {
    margin-top: auto; /* Pushes it to the bottom */
    padding-top: var(--spacing-md); /* Space above it */
    border-top: var(--border-standard); /* Separator line */
    flex-shrink: 0; /* Prevent shrinking */
    position: relative; /* Needed for z-index context if dropdown overflows slightly */
    z-index: 5; /* Lower than dropdown options, but above main panel if needed */
  }
  
  /* Label for the theme switcher */
  .sidebar .theme-switcher label {
    display: block; /* Make label take its own line */
    margin-bottom: var(--spacing-xs);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }
  
  /* REMOVE styles for the old native select, they are handled by CustomSelect.css now */
  /* .sidebar .theme-switcher select { ... } */
  /* .sidebar .theme-switcher select:focus { ... } */
  
  
  /* Main panel containing editor and terminal */
  .main-panel {
    flex-grow: 1; /* Take remaining width */
    display: flex;
    flex-direction: column; /* Stack editor and terminal vertically */
    height: 100%;
    overflow: hidden; /* Prevent this panel itself from scrolling */
  }
  
  /* Editor panel styles */
  .editor-panel {
    flex-grow: 1; /* Take available vertical space */
    background-color: var(--color-bg-main); /* Use variable for background */
    overflow: hidden; /* Monaco Editor manages its own scrolling */
    display: flex; /* Helps child (Monaco editor) fill the space */
    color: var(--color-text-secondary); /* Default text color if editor is empty */
    font-size: var(--font-size-md); /* Base font size for this area */
    position: relative; /* Necessary if Monaco uses absolute positioning */
    min-height: 50px; /* Prevent collapsing completely */
  }
  
  /* Terminal panel styles */
  .terminal-panel {
    height: var(--terminal-height); /* Use variable for height */
    flex-shrink: 0; /* Prevent shrinking when window resizes */
    background-color: var(--color-bg-terminal); /* Use variable */
    color: var(--color-text-terminal); /* Use variable */
    border-top: var(--border-accent); /* Use variable for top border */
    overflow: hidden; /* Xterm manages its own scrolling */
    font-family: var(--font-family-mono); /* Use monospace font variable */
    font-size: var(--font-size-terminal); /* Use terminal font size variable */
    position: relative; /* For potential internal positioning */
    width: 100%;
    display: flex; /* Helps child elements fill the container */
  }
  
  /* Target the direct child wrapper of the terminal panel (often a div) */
  .terminal-panel > div {
       width: 100%;
       height: 100%;
  }
  
  /* Target the main xterm element itself */
  .terminal-panel .terminal.xterm {
      height: 100% !important; /* Ensure it fills the container height */
      width: 100% !important; /* Ensure it fills the container width */
      padding: var(--spacing-xs); /* Add internal padding using variable */
  }
  
  /* Ensure the internal xterm screen fills the terminal element */
   .terminal-panel .xterm-screen {
       width: 100% !important;
       height: 100% !important;
   }
  
  /* Hide any accidental placeholder <p> tags in terminal panel */
  .terminal-panel p {
     display: none;
  }/* --- START FILE: src/renderer/App.css --- */
/* src/renderer/App.css */

.app-container {
  display: flex; /* Use flexbox for Sidebar + Main Panel layout */
  height: 100%;  /* Crucial: Take full viewport height */
  width: 100%;
  background-color: var(--color-bg-app);
  overflow: hidden; /* Prevent body scrollbars */
}

.sidebar {
  width: var(--sidebar-width); /* Use variable */
  flex-shrink: 0; /* Prevent sidebar from shrinking */
  background-color: var(--color-bg-sidebar);
  border-right: var(--border-standard);
  padding: var(--spacing-md);
  height: 100%; /* Take full height of app-container */
  color: var(--color-text-primary);
  display: flex; /* Use flexbox internally */
  flex-direction: column; /* Stack elements vertically */
  overflow: hidden; /* Hide overflow, internal elements scroll */
}

.sidebar h2 {
  margin-bottom: var(--spacing-sm);
  font-size: var(--font-size-lg);
  color: var(--color-text-heading);
  flex-shrink: 0; /* Prevent shrinking */
}

/* Container for the file tree (or its placeholder) */
.sidebar .file-tree-placeholder {
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
    flex-grow: 1; /* Allow placeholder to take remaining vertical space */
    overflow-y: auto; /* Allow scrolling WITHIN this area if content grows */
    min-height: 50px; /* Give it some minimum space */
    margin-bottom: var(--spacing-md); /* Space below it */
    /* Add padding if needed */
    /* padding-bottom: var(--spacing-md); */
}


/* Theme switcher container - Positioned at the bottom */
.sidebar .theme-switcher {
  margin-top: auto; /* Pushes it to the bottom */
  padding-top: var(--spacing-md); /* Space above it */
  border-top: var(--border-standard); /* Separator line */
  flex-shrink: 0; /* Prevent shrinking */
  position: relative; /* Needed for z-index context */
  z-index: 5; /* Lower than dropdown options */
}

/* Label for the theme switcher */
.sidebar .theme-switcher label {
  display: block;
  margin-bottom: var(--spacing-xs);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

/* Main panel containing Allotment */
.main-panel {
  flex-grow: 1; /* Take remaining width */
  display: flex; /* Itself needs to be a flex container for Allotment */
  flex-direction: column; /* Stack editor and terminal vertically (conceptually) */
  height: 100%; /* Crucial: Take full height of app-container */
  overflow: hidden; /* Prevent this panel itself from scrolling */
  background-color: var(--color-bg-main); /* Background for the area Allotment fills */
}

/* Styling for the direct children INSIDE Allotment Panes */
/* Editor panel styles */
.editor-panel {
  /* Removed flex-grow: 1; - Allotment controls height */
  background-color: var(--color-bg-editor); /* Use theme variable */
  overflow: hidden; /* Monaco Editor manages its own scrolling */
  color: var(--color-text-secondary);
  font-size: var(--font-size-md);
  position: relative;
  /* *** CRUCIAL FOR ALLOTMENT CHILD *** */
  height: 100%;
  width: 100%;
  display: flex; /* Ensure Monaco container can fill space */
}

/* Styles for the container div returned by TerminalPanel */
.terminal-panel-container {
   /* Removed fixed height var - Allotment controls height */
   flex-shrink: 0; /* Keep this, although Allotment manages shrinking */
   background-color: var(--color-bg-terminal);
   color: var(--color-text-terminal);
   border-top: var(--border-accent); /* Separator line handled by Allotment sash */
   overflow: hidden; /* Xterm manages its own scrolling */
   font-family: var(--font-family-mono);
   font-size: var(--font-size-terminal);
   position: relative;
   /* *** CRUCIAL FOR ALLOTMENT CHILD *** */
   height: 100%;
   width: 100%;
   display: flex; /* Helps child elements fill the container */
   padding: var(--spacing-xs); /* Add padding INSIDE the terminal container */
}


/* Target the direct child wrapper of the terminal (xterm needs this) */
.terminal-panel-container > div {
     width: 100%;
     height: 100%;
}

/* Target the main xterm element itself for potential overrides */
.terminal-panel-container .terminal.xterm {
    height: 100% !important; /* Ensure it fills the container height */
    width: 100% !important; /* Ensure it fills the container width */
    /* Padding moved to parent container */
}

/* Ensure the internal xterm screen fills the terminal element */
 .terminal-panel-container .xterm-screen {
     width: 100% !important;
     height: 100% !important;
 }

/* Hide any accidental placeholder <p> tags in terminal panel */
.terminal-panel-container p {
   display: none;
}
/* --- END FILE: src/renderer/App.css --- */
--- END FILE: src/renderer/App.css ---

--- START FILE: src/main/env.d.ts ---
interface ImportMetaEnv {
    // Add environment variables used by your main process code here
    readonly VITE_DEV_SERVER_URL?: string; // Optional: Used by Electron window loading logic
    readonly PROD: boolean; // Based on your usage 'import.meta.env.PROD'
    readonly DEV: boolean; // Often useful to have DEV as well
    // Add any other custom VITE_ prefixed variables you might use in main.ts
    // readonly VITE_MY_API_KEY: string;
  }
  
  interface ImportMeta {
    readonly env: ImportMetaEnv;
  }
--- END FILE: src/main/env.d.ts ---

--- START FILE: src/main/index.ts ---
// src/main/index.ts
import { app, BrowserWindow, shell, ipcMain, dialog } from 'electron';
import path from 'node:path';
import os from 'node:os';
import * as pty from 'node-pty';

// --- Global Variables ---
app.disableHardwareAcceleration();
const shellPath = os.platform() === 'win32' ? 'powershell.exe' : 'bash';
let ptyProcess: pty.IPty | null = null;
let mainWindow: BrowserWindow | null = null;

// --- Squirrel Startup Handler (Windows Installer) ---
if (app.isPackaged && process.platform === 'win32') {
    if (require('electron-squirrel-startup')) {
      app.quit();
    }
}

// --- Main Window Creation Function ---
function createWindow() {
  console.log('Creating main window...');
  mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      preload: path.join(__dirname, '../preload/index.js'),
      nodeIntegration: false,
      contextIsolation: true,
    },
  });

  const isDev = !app.isPackaged;
  const VITE_DEV_SERVER_URL = 'http://localhost:5173';

  console.log(`>>> DEBUG: app.isPackaged = ${app.isPackaged}, therefore isDev = ${isDev}`);

  if (isDev && VITE_DEV_SERVER_URL) {
    console.log(`Loading DEV URL: ${VITE_DEV_SERVER_URL}`);
    mainWindow.loadURL(VITE_DEV_SERVER_URL)
      .catch(err => console.error('Failed to load DEV URL:', err));
    mainWindow.webContents.openDevTools();
  } else {
    console.log('Loading PROD build file');
    const prodPath = path.join(__dirname, '..', '..', 'dist', 'renderer', 'index.html');
    console.log(`Attempting to load production file: ${prodPath}`);
    mainWindow.loadFile(prodPath)
       .catch(err => console.error(`Failed to load PROD file: ${prodPath}`, err));
  }

  // --- Window Event Handlers ---
  mainWindow.webContents.setWindowOpenHandler(({ url }) => {
    if (url.startsWith('http:') || url.startsWith('https:')) {
        shell.openExternal(url);
    }
    return { action: 'deny' };
  });

  mainWindow.webContents.on('render-process-gone', (_event, details) => {
    console.error('Renderer process gone:', details);
  });

  mainWindow.webContents.on('did-fail-load', (_event, errorCode, errorDescription, validatedURL) => {
    console.error(`Failed to load URL: ${validatedURL}, ErrorCode: ${errorCode}, Description: ${errorDescription}`);
   });

  mainWindow.on('closed', () => {
    console.log('Main window closed.');
    if (ptyProcess) {
        console.log('Killing PTY process due to window close.');
        ptyProcess.kill();
        ptyProcess = null;
    }
    mainWindow = null;
  });
}

// --- Function to Setup IPC Handlers ---
function setupIpcHandlers() {
    console.log('Setting up IPC Handlers...');

    // Basic Ping Example
    ipcMain.handle('ping', () => 'pong from main!');

    // Handle PTY Creation Request
    ipcMain.handle('pty-create', async (_event, options: { cols: number; rows: number }) => {
        if (!mainWindow) {
            console.error("Cannot create PTY: mainWindow is not available.");
            return { success: false, error: "Main window not available." };
        }
        const targetWebContents = mainWindow.webContents;

        if (ptyProcess) {
            console.log('Existing PTY process found. Killing it before creating a new one.');
            ptyProcess.kill();
            ptyProcess = null;
        }
        console.log(`Creating PTY process with shell: ${shellPath}, cols: ${options.cols}, rows: ${options.rows}`);
        try {
            const cwd = process.env.HOME || process.env.USERPROFILE || process.cwd();
            console.log(`PTY current working directory: ${cwd}`);
            ptyProcess = pty.spawn(shellPath, [], {
                name: 'xterm-color',
                cols: options.cols || 80,
                rows: options.rows || 24,
                cwd: cwd,
                env: { ...process.env },
            });
            console.log(`PTY process created successfully (PID: ${ptyProcess.pid}).`);

            // --- CORRECTED EVENT LISTENER SYNTAX ---
            // Handle Data from PTY -> Renderer
            ptyProcess.onData(data => { // Correct syntax
                 if (targetWebContents && !targetWebContents.isDestroyed()) {
                    targetWebContents.send('pty-data', data);
                 }
            });

            // Handle PTY Exit -> Renderer
            ptyProcess.onExit(({ exitCode, signal }) => { // Correct syntax
                console.log(`PTY process (PID: ${ptyProcess?.pid}) exited with code: ${exitCode}, signal: ${signal}`);
                 if (targetWebContents && !targetWebContents.isDestroyed()) {
                    targetWebContents.send('pty-exit', exitCode);
                 }
                 ptyProcess = null; // Clear the reference on exit
            });
            // --- END CORRECTIONS ---

            // Note: Fatal errors during spawn are caught by the outer try/catch.
            // Runtime errors often result in the process exiting, handled by onExit.

            return { success: true };

        } catch (error) {
            console.error('Failed to create PTY process:', error);
            ptyProcess = null;
            return { success: false, error: error instanceof Error ? error.message : String(error) };
        }
    });

    // Handle Renderer -> PTY (Input)
    ipcMain.on('pty-input', (_event, data: string) => {
        if (ptyProcess) {
            ptyProcess.write(data);
        }
    });

    // Handle Renderer -> PTY (Resize)
    ipcMain.on('pty-resize', (_event, options: { cols: number; rows: number }) => {
        if (ptyProcess) {
            if (options.cols > 0 && options.rows > 0) {
                try {
                    ptyProcess.resize(options.cols, options.rows);
                    // console.log(`Resized PTY (PID: ${ptyProcess.pid}) to cols: ${options.cols}, rows: ${options.rows}`); // Less verbose logging
                } catch (error) {
                     console.error(`Failed to resize PTY (PID: ${ptyProcess.pid}):`, error);
                     // Inform renderer? Debounce?
                }
            } else {
                console.warn(`Received invalid resize dimensions: cols=${options.cols}, rows=${options.rows}`);
            }
        }
    });

    // Example placeholder for opening a folder
    ipcMain.handle('dialog:openDirectory', async () => {
        if (!mainWindow) return null;
        const { canceled, filePaths } = await dialog.showOpenDialog(mainWindow, {
            properties: ['openDirectory']
        });
        if (canceled || filePaths.length === 0) {
            return null;
        } else {
            return filePaths[0];
        }
    });

    console.log('IPC Handlers registered.');
}

// --- App Lifecycle Events ---
app.whenReady().then(() => {
  console.log('App is ready.');
  setupIpcHandlers();
  createWindow();

  app.on('activate', () => {
    if (BrowserWindow.getAllWindows().length === 0) {
        console.log('App activated, creating window.');
        createWindow();
    }
  });
});

app.on('window-all-closed', () => {
  console.log('All windows closed.');
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('will-quit', () => {
    console.log('App will quit. Killing PTY process if exists.');
    if (ptyProcess) {
        ptyProcess.kill();
        ptyProcess = null;
    }
});

process.on('uncaughtException', (error: Error) => {
    console.error('Uncaught Main Process Exception:', error);
    dialog.showErrorBox('Unhandled Main Process Error', error.message || 'An unknown error occurred');
    // Consider if app.quit() is appropriate here
});
--- END FILE: src/main/index.ts ---

--- START FILE: src/shared.types.ts ---
// src/shared.types.ts

// This file can be used to define types that are shared
// between the main process, preload script, and renderer process.

// Example:
// export interface UserPreferences {
//   theme: string;
//   fontSize: number;
// }

// Currently empty.
--- END FILE: src/shared.types.ts ---

--- START FILE: src/preload/index.ts ---
// src/preload/index.ts
import { contextBridge, ipcRenderer, IpcRendererEvent } from 'electron';

// --- Define the shape of the API exposed to the Renderer ---
export interface ElectronAPI {
  // Basic example
  ping: () => Promise<string>;

  // Terminal specific API
  term_create: (options: { cols: number; rows: number }) => Promise<{ success: boolean; error?: string }>; // Return success/error status
  term_write: (data: string) => void; // Send data (user input) to PTY
  term_resize: (options: { cols: number; rows: number }) => void; // Send resize info to PTY

  // Listeners for events FROM Main process TO Renderer
  // These return an unsubscribe function
  term_onData: (callback: (data: string) => void) => () => void;
  term_onExit: (callback: (code?: number) => void) => () => void;
  term_onError: (callback: (errorMessage: string) => void) => () => void; // Listener for PTY errors

  // Dialog (Filesystem access via Main)
  dialog_openDirectory: () => Promise<string | null>; // Returns selected path or null
}

// --- Implementation of the API ---
const api: ElectronAPI = {
  ping: () => ipcRenderer.invoke('ping'),

  // Terminal methods
  term_create: (options) => ipcRenderer.invoke('pty-create', options),
  term_write: (data) => ipcRenderer.send('pty-input', data), // 'send' is fire-and-forget
  term_resize: (options) => ipcRenderer.send('pty-resize', options), // 'send' is fire-and-forget

  // Setup listeners for Main -> Renderer communication
  term_onData: (callback) => {
    const subscription = (_event: IpcRendererEvent, data: string) => callback(data);
    ipcRenderer.on('pty-data', subscription);
    // Return the unsubscribe function
    return () => {
      ipcRenderer.removeListener('pty-data', subscription);
    };
  },

  term_onExit: (callback) => {
     const subscription = (_event: IpcRendererEvent, code?: number) => callback(code);
     ipcRenderer.on('pty-exit', subscription);
     // Return the unsubscribe function
     return () => {
       ipcRenderer.removeListener('pty-exit', subscription);
     };
  },

  term_onError: (callback) => {
    const subscription = (_event: IpcRendererEvent, errorMessage: string) => callback(errorMessage);
    ipcRenderer.on('pty-error', subscription); // Listen for 'pty-error' channel from main
    // Return the unsubscribe function
    return () => {
      ipcRenderer.removeListener('pty-error', subscription);
    };
 },

  // Dialog methods
  dialog_openDirectory: () => ipcRenderer.invoke('dialog:openDirectory'),
};

// --- Expose the API to the Renderer process ---
try {
  contextBridge.exposeInMainWorld('electronAPI', api);
  console.log('Preload script exposed electronAPI successfully.');
} catch (error) {
  console.error('Error exposing context bridge in preload script:', error);
}
--- END FILE: src/preload/index.ts ---

--- START FILE: codebase.txt ---
--- END FILE: codebase.txt ---

--- START FILE: package.json ---
{
  "name": "codecraft-ide",
  "version": "0.1.0",
  "description": "A custom IDE built with Electron, React, and TypeScript",
  "main": "dist-electron/main/index.js",
  "scripts": {
    "start": "electron .",
    "dev:vite": "vite --config vite.config.mjs --debug",
    "dev:main": "tsc --project tsconfig.node.json --watch",
    "dev": "echo \"Run 'npm run dev:main' and 'npm run dev:vite' in separate terminals, then 'npm start'\" && exit 1",
    "build:main": "tsc --project tsconfig.node.json",
    "build:renderer": "vite build --config vite.config.mjs",
    "build": "npm run clean && npm run build:main && npm run build:renderer && electron-builder",
    "rebuild": "electron-rebuild -f -w node-pty",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "clean": "rm -rf dist dist-electron build release",
    "postinstall": "electron-builder install-app-deps"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "allotment": "^1.20.3",
    "electron-squirrel-startup": "^1.0.1",
    "node-pty": "^1.0.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-monaco-editor": "^0.58.0",
    "xterm": "^5.3.0",
    "xterm-addon-fit": "^0.8.0"
  },
  "devDependencies": {
    "@types/node": "^20.14.2",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@typescript-eslint/eslint-plugin": "^7.12.0",
    "@typescript-eslint/parser": "^7.12.0",
    "@vitejs/plugin-react": "^4.3.1",
    "electron": "^30.0.9",
    "electron-builder": "^24.13.3",
    "electron-rebuild": "^3.2.9",
    "eslint": "^8.57.0",
    "eslint-plugin-react": "^7.34.2",
    "eslint-plugin-react-hooks": "^4.6.2",
    "typescript": "^5.4.5",
    "vite": "^5.2.12",
    "vite-plugin-monaco-editor": "^1.1.0"
  },
  "build": {
    "appId": "com.example.codecraftide",
    "productName": "CodeCraft IDE",
    "files": [
      "dist/**/*",
      "dist-electron/**/*",
      "index.html",
      "package.json"
    ],
    "directories": {
      "buildResources": "assets",
      "output": "release/${version}"
    },
    "win": {
      "target": "nsis",
      "icon": "assets/icon.ico"
    },
    "mac": {
      "target": "dmg",
      "icon": "assets/icon.icns"
    },
    "linux": {
      "target": "AppImage",
      "icon": "assets/icon.png"
    },
    "nsis": {
      "oneClick": false,
      "allowToChangeInstallationDirectory": true
    }
  }
}
--- END FILE: package.json ---

--- START FILE: dist-electron/shared.types.d.ts ---

--- END FILE: dist-electron/shared.types.d.ts ---

--- START FILE: dist-electron/main/index.js ---
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// src/main/index.ts
const electron_1 = require("electron");
const node_path_1 = __importDefault(require("node:path"));
const node_os_1 = __importDefault(require("node:os"));
const pty = __importStar(require("node-pty"));
// --- Global Variables ---
electron_1.app.disableHardwareAcceleration();
const shellPath = node_os_1.default.platform() === 'win32' ? 'powershell.exe' : 'bash';
let ptyProcess = null;
let mainWindow = null;
// --- Squirrel Startup Handler (Windows Installer) ---
if (electron_1.app.isPackaged && process.platform === 'win32') {
    if (require('electron-squirrel-startup')) {
        electron_1.app.quit();
    }
}
// --- Main Window Creation Function ---
function createWindow() {
    console.log('Creating main window...');
    mainWindow = new electron_1.BrowserWindow({
        width: 1200,
        height: 800,
        webPreferences: {
            preload: node_path_1.default.join(__dirname, '../preload/index.js'),
            nodeIntegration: false,
            contextIsolation: true,
        },
    });
    const isDev = !electron_1.app.isPackaged;
    const VITE_DEV_SERVER_URL = 'http://localhost:5173';
    console.log(`>>> DEBUG: app.isPackaged = ${electron_1.app.isPackaged}, therefore isDev = ${isDev}`);
    if (isDev && VITE_DEV_SERVER_URL) {
        console.log(`Loading DEV URL: ${VITE_DEV_SERVER_URL}`);
        mainWindow.loadURL(VITE_DEV_SERVER_URL)
            .catch(err => console.error('Failed to load DEV URL:', err));
        mainWindow.webContents.openDevTools();
    }
    else {
        console.log('Loading PROD build file');
        const prodPath = node_path_1.default.join(__dirname, '..', '..', 'dist', 'renderer', 'index.html');
        console.log(`Attempting to load production file: ${prodPath}`);
        mainWindow.loadFile(prodPath)
            .catch(err => console.error(`Failed to load PROD file: ${prodPath}`, err));
    }
    // --- Window Event Handlers ---
    mainWindow.webContents.setWindowOpenHandler(({ url }) => {
        if (url.startsWith('http:') || url.startsWith('https:')) {
            electron_1.shell.openExternal(url);
        }
        return { action: 'deny' };
    });
    mainWindow.webContents.on('render-process-gone', (_event, details) => {
        console.error('Renderer process gone:', details);
    });
    mainWindow.webContents.on('did-fail-load', (_event, errorCode, errorDescription, validatedURL) => {
        console.error(`Failed to load URL: ${validatedURL}, ErrorCode: ${errorCode}, Description: ${errorDescription}`);
    });
    mainWindow.on('closed', () => {
        console.log('Main window closed.');
        if (ptyProcess) {
            console.log('Killing PTY process due to window close.');
            ptyProcess.kill();
            ptyProcess = null;
        }
        mainWindow = null;
    });
}
// --- Function to Setup IPC Handlers ---
function setupIpcHandlers() {
    console.log('Setting up IPC Handlers...');
    // Basic Ping Example
    electron_1.ipcMain.handle('ping', () => 'pong from main!');
    // Handle PTY Creation Request
    electron_1.ipcMain.handle('pty-create', async (_event, options) => {
        if (!mainWindow) {
            console.error("Cannot create PTY: mainWindow is not available.");
            return { success: false, error: "Main window not available." };
        }
        const targetWebContents = mainWindow.webContents;
        if (ptyProcess) {
            console.log('Existing PTY process found. Killing it before creating a new one.');
            ptyProcess.kill();
            ptyProcess = null;
        }
        console.log(`Creating PTY process with shell: ${shellPath}, cols: ${options.cols}, rows: ${options.rows}`);
        try {
            const cwd = process.env.HOME || process.env.USERPROFILE || process.cwd();
            console.log(`PTY current working directory: ${cwd}`);
            ptyProcess = pty.spawn(shellPath, [], {
                name: 'xterm-color',
                cols: options.cols || 80,
                rows: options.rows || 24,
                cwd: cwd,
                env: { ...process.env },
            });
            console.log(`PTY process created successfully (PID: ${ptyProcess.pid}).`);
            // --- CORRECTED EVENT LISTENER SYNTAX ---
            // Handle Data from PTY -> Renderer
            ptyProcess.onData(data => {
                if (targetWebContents && !targetWebContents.isDestroyed()) {
                    targetWebContents.send('pty-data', data);
                }
            });
            // Handle PTY Exit -> Renderer
            ptyProcess.onExit(({ exitCode, signal }) => {
                console.log(`PTY process (PID: ${ptyProcess?.pid}) exited with code: ${exitCode}, signal: ${signal}`);
                if (targetWebContents && !targetWebContents.isDestroyed()) {
                    targetWebContents.send('pty-exit', exitCode);
                }
                ptyProcess = null; // Clear the reference on exit
            });
            // --- END CORRECTIONS ---
            // Note: Fatal errors during spawn are caught by the outer try/catch.
            // Runtime errors often result in the process exiting, handled by onExit.
            return { success: true };
        }
        catch (error) {
            console.error('Failed to create PTY process:', error);
            ptyProcess = null;
            return { success: false, error: error instanceof Error ? error.message : String(error) };
        }
    });
    // Handle Renderer -> PTY (Input)
    electron_1.ipcMain.on('pty-input', (_event, data) => {
        if (ptyProcess) {
            ptyProcess.write(data);
        }
    });
    // Handle Renderer -> PTY (Resize)
    electron_1.ipcMain.on('pty-resize', (_event, options) => {
        if (ptyProcess) {
            if (options.cols > 0 && options.rows > 0) {
                try {
                    ptyProcess.resize(options.cols, options.rows);
                    // console.log(`Resized PTY (PID: ${ptyProcess.pid}) to cols: ${options.cols}, rows: ${options.rows}`); // Less verbose logging
                }
                catch (error) {
                    console.error(`Failed to resize PTY (PID: ${ptyProcess.pid}):`, error);
                    // Inform renderer? Debounce?
                }
            }
            else {
                console.warn(`Received invalid resize dimensions: cols=${options.cols}, rows=${options.rows}`);
            }
        }
    });
    // Example placeholder for opening a folder
    electron_1.ipcMain.handle('dialog:openDirectory', async () => {
        if (!mainWindow)
            return null;
        const { canceled, filePaths } = await electron_1.dialog.showOpenDialog(mainWindow, {
            properties: ['openDirectory']
        });
        if (canceled || filePaths.length === 0) {
            return null;
        }
        else {
            return filePaths[0];
        }
    });
    console.log('IPC Handlers registered.');
}
// --- App Lifecycle Events ---
electron_1.app.whenReady().then(() => {
    console.log('App is ready.');
    setupIpcHandlers();
    createWindow();
    electron_1.app.on('activate', () => {
        if (electron_1.BrowserWindow.getAllWindows().length === 0) {
            console.log('App activated, creating window.');
            createWindow();
        }
    });
});
electron_1.app.on('window-all-closed', () => {
    console.log('All windows closed.');
    if (process.platform !== 'darwin') {
        electron_1.app.quit();
    }
});
electron_1.app.on('will-quit', () => {
    console.log('App will quit. Killing PTY process if exists.');
    if (ptyProcess) {
        ptyProcess.kill();
        ptyProcess = null;
    }
});
process.on('uncaughtException', (error) => {
    console.error('Uncaught Main Process Exception:', error);
    electron_1.dialog.showErrorBox('Unhandled Main Process Error', error.message || 'An unknown error occurred');
    // Consider if app.quit() is appropriate here
});
--- END FILE: dist-electron/main/index.js ---

--- START FILE: dist-electron/main/index.d.ts ---
export {};
--- END FILE: dist-electron/main/index.d.ts ---

--- START FILE: dist-electron/shared.types.js ---
"use strict";
// src/shared.types.ts
// This file can be used to define types that are shared
// between the main process, preload script, and renderer process.
// Example:
// export interface UserPreferences {
//   theme: string;
//   fontSize: number;
// }
// Currently empty.
--- END FILE: dist-electron/shared.types.js ---

--- START FILE: dist-electron/preload/index.js ---
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// src/preload/index.ts
const electron_1 = require("electron");
// --- Implementation of the API ---
const api = {
    ping: () => electron_1.ipcRenderer.invoke('ping'),
    // Terminal methods
    term_create: (options) => electron_1.ipcRenderer.invoke('pty-create', options),
    term_write: (data) => electron_1.ipcRenderer.send('pty-input', data), // 'send' is fire-and-forget
    term_resize: (options) => electron_1.ipcRenderer.send('pty-resize', options), // 'send' is fire-and-forget
    // Setup listeners for Main -> Renderer communication
    term_onData: (callback) => {
        const subscription = (_event, data) => callback(data);
        electron_1.ipcRenderer.on('pty-data', subscription);
        // Return the unsubscribe function
        return () => {
            electron_1.ipcRenderer.removeListener('pty-data', subscription);
        };
    },
    term_onExit: (callback) => {
        const subscription = (_event, code) => callback(code);
        electron_1.ipcRenderer.on('pty-exit', subscription);
        // Return the unsubscribe function
        return () => {
            electron_1.ipcRenderer.removeListener('pty-exit', subscription);
        };
    },
    term_onError: (callback) => {
        const subscription = (_event, errorMessage) => callback(errorMessage);
        electron_1.ipcRenderer.on('pty-error', subscription); // Listen for 'pty-error' channel from main
        // Return the unsubscribe function
        return () => {
            electron_1.ipcRenderer.removeListener('pty-error', subscription);
        };
    },
    // Dialog methods
    dialog_openDirectory: () => electron_1.ipcRenderer.invoke('dialog:openDirectory'),
};
// --- Expose the API to the Renderer process ---
try {
    electron_1.contextBridge.exposeInMainWorld('electronAPI', api);
    console.log('Preload script exposed electronAPI successfully.');
}
catch (error) {
    console.error('Error exposing context bridge in preload script:', error);
}
--- END FILE: dist-electron/preload/index.js ---

--- START FILE: dist-electron/preload/index.d.ts ---
export interface ElectronAPI {
    ping: () => Promise<string>;
    term_create: (options: {
        cols: number;
        rows: number;
    }) => Promise<{
        success: boolean;
        error?: string;
    }>;
    term_write: (data: string) => void;
    term_resize: (options: {
        cols: number;
        rows: number;
    }) => void;
    term_onData: (callback: (data: string) => void) => () => void;
    term_onExit: (callback: (code?: number) => void) => () => void;
    term_onError: (callback: (errorMessage: string) => void) => () => void;
    dialog_openDirectory: () => Promise<string | null>;
}
--- END FILE: dist-electron/preload/index.d.ts ---

